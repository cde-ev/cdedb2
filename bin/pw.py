#!/usr/bin/env python3

from playwright.sync_api import sync_playwright, expect

with sync_playwright() as p:
    browser = p.chromium.launch()
    page = browser.new_page(ignore_https_errors=True)
    page.goto("https://localhost/db/")
    page.get_by_label("E-Mail").fill("anton@example.cde")
    page.get_by_label("Passwort").fill("secret")
    page.get_by_role("button", name="Anmelden").click()
    page.wait_for_url("https://localhost/db/")
    page.get_by_role("link", name="Versammlungen").click()
    page.wait_for_url("https://localhost/db/assembly/")
    page.get_by_role("link", name="Internationaler Kongress").click()
    page.wait_for_url("https://localhost/db/assembly/assembly/1/show")
    page.get_by_role("link", name="Abstimmungen").click()
    page.wait_for_url("https://localhost/db/assembly/assembly/1/ballot/list")
    page.get_by_role("link", name="Lieblingszahl").click()
    page.wait_for_url("https://localhost/db/assembly/assembly/1/ballot/5/show")
    page.get_by_role("tab", name="Interaktive Abstimmung").click()
    page.locator("#vote-cand_24").click()
    page.locator("#prefvote_container div").nth(1).click()
    page.locator("#vote-cand_25").click()
    page.locator("#prefvote_container > div:nth-child(6)").click()
    page.locator("#vote-cand_26").click()
    page.locator("#prefvote_container div:has-text(\"pi\")").click()
    page.locator("#vote-cand_27").click()
    page.locator("div:nth-child(8)").click()
    page.get_by_role("button", name="Abstimmen").click()
    page.wait_for_url("https://localhost/db/assembly/assembly/1/ballot/5/show")
    page.get_by_role("tab", name="Text-basierte Abstimmung").click()
    expect(page.get_by_label("PrÃ¤ferenzliste")).to_have_value('pi=1>i>e>0')
    browser.close()

