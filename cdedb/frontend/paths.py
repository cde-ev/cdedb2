#!/usr/bin/env python3

"""Routing table for the WSGI-application. This will get pretty big so put
it here where it is out of the way.
"""

import werkzeug.routing

rule = werkzeug.routing.Rule
sub = werkzeug.routing.Submount


class FilenameConverter(werkzeug.routing.BaseConverter):
    """Handles filename inputs in URL path."""
    regex = '[a-zA-Z0-9][-a-zA-Z0-9._]*'


# shorthands, mainly to avoid missing the comma to make a tuple for POST
_GET = ("GET", "HEAD")
_POST = ("POST",)

#: Using a routing map allows to do lookups as well as the reverse process
#: of generating links to targets instead of hardcoding them.


CDEDB_PATHS = werkzeug.routing.Map((
    werkzeug.routing.EndpointPrefix('core/', (
        rule("/", methods=_GET,
             endpoint="index"),
        sub('/core', (
            rule("/api/resolve", methods=_GET,
                 endpoint="api_resolve_username"),
            rule("/markdown/parse", methods=_POST,
                 endpoint="markdown_parse"),
            rule("/login", methods=_POST,
                 endpoint="login"),
            rule("/logout", methods=_POST,
                 endpoint="logout"),
            rule("/logout/all", methods=_POST,
                 endpoint="logout_all"),
            rule("/locale", methods=_POST,
                 endpoint="change_locale"),
            rule("/admin_views", methods=_POST,
                 endpoint="modify_active_admin_views"),
            rule("/admins", methods=_GET,
                 endpoint="view_admins"),
            sub("/contact", (
                rule("/", methods=_GET,
                     endpoint="contact_form"),
                rule("/", methods=_POST,
                     endpoint="contact"),
                rule("/reply", methods=_GET,
                     endpoint="contact_reply_form"),
                rule("/reply", methods=_POST,
                     endpoint="contact_reply"),
                rule("/rotate", methods=_GET,
                     endpoint="rotate_anonymous_message"),
            )),
            rule("/log", methods=_GET,
                 endpoint="view_log"),
            rule("/meta", methods=_GET,
                 endpoint="meta_info_form"),
            rule("/meta", methods=_POST,
                 endpoint="change_meta_info"),
            rule("/user/create", methods=_GET,
                 endpoint="create_user_form"),
            rule("/user/create/redirect", methods=_GET,
                 endpoint="create_user"),
            rule("/persona/adminshow", methods=_GET,
                 endpoint="admin_show_user"),
            rule("/persona/select", methods=_GET,
                 endpoint="select_persona"),
            rule("/changelog/list", methods=_GET,
                 endpoint="list_pending_changes"),
            rule("/changelog/view", methods=_GET,
                 endpoint="view_changelog_meta"),
            rule("/foto/<filename:foto>", methods=_GET,
                 endpoint="get_foto"),
            rule("/debugemail/<token>", methods=_GET,
                 endpoint="debug_email"),
            sub('/self', (
                rule("/show", methods=_GET,
                     endpoint="mydata"),
                rule("/change", methods=_GET,
                     endpoint="change_user_form"),
                rule("/change", methods=_POST,
                     endpoint="change_user"),
                rule("/password/change", methods=_GET,
                     endpoint="change_password_form"),
                rule("/password/change", methods=_POST,
                     endpoint="change_password"),
                rule("/events", methods=_GET,
                     endpoint="show_user_events_self"),
                rule("/mailinglists", methods=_GET,
                     endpoint="show_user_mailinglists_self"),
                rule("/lastschrift", methods=_GET,
                     endpoint="my_lastschrift"))),
            sub('/self/username', (
                rule("/change", methods=_GET,
                     endpoint="change_username_form"),
                rule("/change/mail", methods=_GET,
                     endpoint="send_username_change_link"),
                rule("/change/confirm", methods=_GET,
                     endpoint="do_username_change_form"),
                rule("/change", methods=_POST,
                     endpoint="do_username_change"))),
            sub('/password', (
                rule("/reset", methods=_GET,
                     endpoint="reset_password_form"),
                rule("/reset/mail", methods=_GET,
                     endpoint="send_password_reset_link"),
                rule("/reset/confirm", methods=_GET,
                     endpoint="do_password_reset_form"),
                rule("/reset", methods=_POST,
                     endpoint="do_password_reset"))),
            rule('/search/user', methods=_GET,
                 endpoint="user_search"),
            sub('/emailstatus', (
                rule('/list', methods=_GET,
                     endpoint="email_status_overview"),
                rule('/set', methods=_POST,
                     endpoint="set_email_status"),
                rule('/delete', methods=_POST,
                     endpoint="delete_email_status"))),
            sub('/persona/<int:persona_id>', (
                rule("/adminchange", methods=_GET,
                     endpoint="admin_change_user_form"),
                rule("/adminchange", methods=_POST,
                     endpoint="admin_change_user"),
                rule("/password/reset", methods=_POST,
                     endpoint="admin_send_password_reset_link"),
                rule("/password/invalidate", methods=_POST,
                     endpoint="invalidate_password"),
                rule("/privileges", methods=_GET,
                     endpoint="change_privileges_form"),
                rule("/privileges", methods=_POST,
                     endpoint="change_privileges"),
                rule("/promote", methods=_GET,
                     endpoint="promote_user_form"),
                rule("/promote", methods=_POST,
                     endpoint="promote_user"),
                rule("/membership/change", methods=_GET,
                     endpoint="modify_membership_form"),
                rule("/membership/change", methods=_POST,
                     endpoint="modify_membership"),
                rule("/balance/change", methods=_GET,
                     endpoint="modify_balance_form"),
                rule("/balance/change", methods=_POST,
                     endpoint="modify_balance"),
                rule("/foto/change", methods=_GET,
                     endpoint="set_foto_form"),
                rule("/foto/change", methods=_POST,
                     endpoint="set_foto"),
                rule("/username/adminchange", methods=_GET,
                     endpoint="admin_username_change_form"),
                rule("/username/adminchange", methods=_POST,
                     endpoint="admin_username_change"),
                rule("/changelog/inspect", methods=_GET,
                     endpoint="inspect_change"),
                rule("/changelog/resolve", methods=_POST,
                     endpoint="resolve_change"),
                rule("/show", methods=_GET,
                     endpoint="show_user"),
                rule("/events", methods=_GET,
                     endpoint="show_user_events"),
                rule("/mailinglists", methods=_GET,
                     endpoint="show_user_mailinglists"),
                rule("/vcard", methods=_GET,
                     endpoint="download_vcard"),
                rule("/vcard/qr", methods=_GET,
                     endpoint="qr_vcard"),
                rule("/history", methods=_GET,
                     endpoint="show_history"),
                rule("/archive", methods=_POST,
                     endpoint="archive_persona"),
                rule("/dearchive", methods=_GET,
                     endpoint="dearchive_persona_form"),
                rule("/dearchive", methods=_POST,
                     endpoint="dearchive_persona"),
                rule("/purge", methods=_POST,
                     endpoint="purge_persona"),
                rule("/activity/change", methods=_POST,
                     endpoint="toggle_activity"))),
            sub('/genesis', (
                rule("/request", methods=_GET,
                     endpoint="genesis_request_form"),
                rule("/request", methods=_POST,
                     endpoint="genesis_request"),
                rule("/verify", methods=_GET,
                     endpoint="genesis_verify"),
                rule("/list", methods=_GET,
                     endpoint="genesis_list_cases"),
                rule("/attachment/<filename:attachment_hash>", methods=_GET,
                     endpoint="genesis_get_attachment"))),
            sub('/genesis/<int:genesis_case_id>', (
                rule("/show", methods=_GET,
                     endpoint="genesis_show_case"),
                rule("/modify", methods=_GET,
                     endpoint="genesis_modify_form"),
                rule("/modify", methods=_POST,
                     endpoint="genesis_modify"),
                rule("/decide", methods=_POST,
                     endpoint="genesis_decide"))),
            sub('/privileges', (
                rule("/list", methods=_GET,
                     endpoint="list_privilege_changes"),)),
            sub('/privileges/<int:privilege_change_id>', (
                rule("/show", methods=_GET,
                     endpoint="show_privilege_change"),
                rule("/decide", methods=_POST,
                     endpoint="decide_privilege_change"))),
        )))),
    werkzeug.routing.EndpointPrefix('cde/', (
        sub('/cde', (
            rule("/", methods=_GET,
                 endpoint="index"),
            rule("/stats", methods=_GET,
                 endpoint="member_stats"),
            rule("/log", methods=_GET,
                 endpoint="view_cde_log"),
            rule("/misc", methods=_GET,
                 endpoint="view_misc"),
            rule("/finances", methods=_GET,
                 endpoint="view_finance_log"),
            rule("/user/create", methods=_GET,
                 endpoint="create_user_form"),
            rule("/user/create", methods=_POST,
                 endpoint="create_user"),
            rule("/admission", methods=_GET,
                 endpoint="batch_admission_form"),
            rule("/admission", methods=_POST,
                 endpoint="batch_admission"),
            rule("/parse", methods=_GET,
                 endpoint="parse_statement_form"),
            rule("/parse", methods=_POST,
                 endpoint="parse_statement"),
            rule("/parse/download", methods=_POST,
                 endpoint="parse_download"),
            rule("/transfers", methods=_GET,
                 endpoint="money_transfers_form"),
            rule("/transfers", methods=_POST,
                 endpoint="money_transfers"),
            sub('/self', (
                rule("/consent", methods=_GET,
                     endpoint="consent_decision_form"),
                rule("/consent", methods=_POST,
                     endpoint="consent_decision"))),
            sub('/search', (
                rule("/member", methods=_GET,
                     endpoint="member_search"),
                rule("/user", methods=_GET,
                     endpoint="user_search"),
                rule("/course", methods=_GET,
                     endpoint="past_course_search"))),
            rule("/i25p", endpoint="", redirect_to="cde/lastschrift/info"),
            sub("/lastschrift/", (
                rule("/", methods=_GET,
                     endpoint="lastschrift_index"),
                rule("/create", methods=_GET,
                     endpoint="lastschrift_create_form"),
                rule("/create", methods=_POST,
                     endpoint="lastschrift_create"),
                rule("/form/download", methods=_GET,
                     endpoint="lastschrift_subscription_form"),
                rule("/form/fill", methods=_GET,
                     endpoint="lastschrift_subscription_form_fill"),
                rule("/info", methods=_GET,
                     endpoint="i25p_index"),
                rule("/transaction/download", methods=_GET,
                     endpoint="lastschrift_download_sepapain"),
                rule("/transaction/generate", methods=_POST,
                     endpoint="lastschrift_generate_transactions"),
                rule("/transaction/finalize", methods=_POST,
                     endpoint="lastschrift_finalize_transactions"))),
            sub('/past/', (
                rule("/event/list", methods=_GET,
                     endpoint="list_past_events"),
                rule("/event/create", methods=_GET,
                     endpoint="create_past_event_form"),
                rule("/event/create", methods=_POST,
                     endpoint="create_past_event"),
                rule("/log", methods=_GET,
                     endpoint="view_past_log"),
                sub('/event/<int:pevent_id>', (
                    rule("/show", methods=_GET,
                         endpoint="show_past_event"),
                    rule("/download", methods=_GET,
                         endpoint="download_past_event_participantlist"),
                    rule("/change", methods=_GET,
                         endpoint="change_past_event_form"),
                    rule("/change", methods=_POST,
                         endpoint="change_past_event"),
                    rule("/delete", methods=_POST,
                         endpoint="delete_past_event"),
                    rule("/course/create", methods=_GET,
                         endpoint="create_past_course_form"),
                    rule("/course/create", methods=_POST,
                         endpoint="create_past_course"),
                    rule("/participant/add", methods=_POST,
                         endpoint="add_participants"),
                    rule("/participant/remove", methods=_POST,
                         endpoint="remove_participant"),
                    sub('/course/<int:pcourse_id>', (
                        rule("/participant/add", methods=_POST,
                             endpoint="add_participants"),
                        rule("/participant/remove", methods=_POST,
                             endpoint="remove_participant"),
                        rule("/show", methods=_GET,
                             endpoint="show_past_course"),
                        rule("/change", methods=_GET,
                             endpoint="change_past_course_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_past_course"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_past_course"))))))),
            sub('/lastschrift/<int:lastschrift_id>', (
                rule("/skip", methods=_POST,
                     endpoint="lastschrift_skip"),
                rule("/change", methods=_GET,
                     endpoint="lastschrift_change_form"),
                rule("/change", methods=_POST,
                     endpoint="lastschrift_change"),
                rule("/revoke", methods=_POST,
                     endpoint="lastschrift_revoke"),
                sub('/transaction/<int:transaction_id>', (
                    rule("/finalize", methods=_POST,
                         endpoint="lastschrift_finalize_transaction"),
                    rule("/rollback", methods=_POST,
                         endpoint="lastschrift_rollback_transaction"))))),
            sub('/user/<int:persona_id>', (
                rule("/lastschrift", methods=_GET,
                     endpoint="lastschrift_show"),
                rule("/lastschrift/create", methods=_GET,
                     endpoint="lastschrift_create_form"),
                rule("/lastschrift/create", methods=_POST,
                     endpoint="lastschrift_create"))),
            sub('/semester', (
                rule("/show", methods=_GET,
                     endpoint="show_semester"),
                rule("/bill", methods=_POST,
                     endpoint="semester_bill"),
                rule("/eject", methods=_POST,
                     endpoint="semester_eject"),
                rule("/balance", methods=_POST,
                     endpoint="semester_balance_update"),
            )),
            sub('/expuls', (
                rule("/address", methods=_POST,
                     endpoint="expuls_addresscheck"),
                rule("/advance", methods=_POST,
                     endpoint="expuls_advance"))),
        )),)),
    werkzeug.routing.EndpointPrefix('event/', (
        sub('/event', (
            rule("/", methods=_GET,
                 endpoint="index"),
            rule('/search/user', methods=_GET,
                 endpoint="user_search"),
            rule("/registration/select", methods=_GET,
                 endpoint="select_registration"),
            rule("/offline/partial", methods=_GET,
                 endpoint="download_quick_partial_export"),
            rule("/user/create", methods=_GET,
                 endpoint="create_user_form"),
            rule("/user/create", methods=_POST,
                 endpoint="create_user"),
            rule("/log", methods=_GET,
                 endpoint="view_log"),
            sub('/event', (
                rule("/list", methods=_GET,
                     endpoint="list_events"),
                rule("/create", methods=_GET,
                     endpoint="create_event_form"),
                rule("/create", methods=_POST,
                     endpoint="create_event"),
                rule("/select", methods=_GET,
                     endpoint="select_event"),
            )),
            sub('/event/<int:event_id>', (
                rule("/show", methods=_GET,
                     endpoint="show_event"),
                rule("/log", methods=_GET,
                     endpoint="view_event_log"),
                rule("/ml/create", methods=_POST,
                     endpoint="create_event_mailinglist"),
                rule("/stats", methods=_GET,
                     endpoint="stats"),
                rule("/notes", methods=_GET,
                     endpoint="participant_info"),
                rule("/export", methods=_GET,
                     endpoint="download_export"),
                rule("/lock", methods=_POST,
                     endpoint="lock_event"),
                rule("/unlock", methods=_POST,
                     endpoint="unlock_event"),
                rule("/archive", methods=_POST,
                     endpoint="archive_event"),
                rule("/delete", methods=_POST,
                     endpoint="delete_event"),
                rule("/change", methods=_GET,
                     endpoint="change_event_form"),
                rule("/change", methods=_POST,
                     endpoint="change_event"),
                rule("/batchfees", methods=_GET,
                     endpoint="batch_fees_form"),
                rule("/batchfees", methods=_POST,
                     endpoint="batch_fees"),
                rule("/checkin", methods=_GET,
                     endpoint="checkin_form"),
                rule("/checkin", methods=_POST,
                     endpoint="checkin"),
                sub('/droid', (
                    # API-functionality:
                    rule("/partial", methods=_GET,
                         endpoint="droid_partial_export"),
                    # Token management:
                    rule("/summary", methods=_GET,
                         endpoint="orga_token_summary"),
                    rule("/create", methods=_GET,
                         endpoint="create_orga_token_form"),
                    rule("/create", methods=_POST,
                         endpoint="create_orga_token"),
                    sub("/<int:orga_token_id>", (
                        rule("/change", methods=_GET,
                             endpoint="change_orga_token_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_orga_token"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_orga_token"),
                        rule("/revoke", methods=_POST,
                             endpoint="revoke_orga_token"),
                    )),
                )),
                sub('/minorform', (
                    rule("/get", methods=_GET,
                         endpoint="get_minor_form"),
                    rule("/change", methods=_POST,
                         endpoint="change_minor_form"),
                )),
                sub('/orga', (
                    rule("/add", methods=_POST,
                         endpoint="add_orga"),
                    rule("/remove", methods=_POST,
                         endpoint="remove_orga"),
                )),
                sub('/query', (
                    sub('/filter', (
                        rule("/", methods=_GET,
                             endpoint="custom_filter_summary"),
                        sub("/create", (
                            rule("/", methods=_POST,
                                 endpoint="create_custom_filter"),
                            rule("/registration", methods=_GET,
                                 endpoint="create_registration_filter"),
                            rule("/course", methods=_GET,
                                 endpoint="create_course_filter"),
                            rule("/lodgement", methods=_GET,
                                 endpoint="create_lodgement_filter"),
                        )),
                        sub('/<int:custom_filter_id>', (
                            rule("/change", methods=_GET,
                                 endpoint="change_custom_filter_form"),
                            rule("/change", methods=_POST,
                                 endpoint="change_custom_filter"),
                            rule("/delete", methods=_POST,
                                 endpoint="delete_custom_filter"),
                        )),
                    )),
                    rule("/store", methods=_POST,
                         endpoint="store_event_query"),
                    rule("/delete", methods=_POST,
                         endpoint="delete_event_query"),
                )),
                rule("/register", methods=_GET,
                     endpoint="register_form"),
                rule("/register", methods=_POST,
                     endpoint="register"),
                sub('/register', (
                    rule("/config", methods=_GET,
                         endpoint="configure_registration_form"),
                    rule("/config", methods=_POST,
                         endpoint="configure_registration"),
                    rule("/fee", methods=_GET,
                         endpoint="precompute_fee"),
                )),
                sub('/questionnaire', (
                    rule("/config", methods=_GET,
                         endpoint="configure_additional_questionnaire_form"),
                    rule("/config", methods=_POST,
                         endpoint="configure_additional_questionnaire"),
                    rule("/reorder", methods=_GET,
                         endpoint="reorder_questionnaire_form"),
                    rule("/reorder", methods=_POST,
                         endpoint="reorder_questionnaire"),
                )),
                sub("/import", (
                    rule("/partial", methods=_GET,
                         endpoint="partial_import_form"),
                    rule("/partial", methods=_POST,
                         endpoint="partial_import"),
                    rule("/questionnaire", methods=_GET,
                         endpoint="questionnaire_import_form"),
                    rule("/questionnaire", methods=_POST,
                         endpoint="questionnaire_import"),
                )),
                rule("/download", methods=_GET,
                     endpoint="downloads"),
                sub("/download", (
                    rule("/nametag", methods=_GET,
                         endpoint="download_nametags"),
                    rule("/coursepuzzle", methods=_GET,
                         endpoint="download_course_puzzle"),
                    rule("/lodgementpuzzle", methods=_GET,
                         endpoint="download_lodgement_puzzle"),
                    rule("/courselists", methods=_GET,
                         endpoint="download_course_lists"),
                    rule("/lodgementlists", methods=_GET,
                         endpoint="download_lodgement_lists"),
                    rule("/participantlist", methods=_GET,
                         endpoint="download_participant_list"),
                    rule("/dokuteam_course", methods=_GET,
                         endpoint="download_dokuteam_courselist"),
                    rule("/dokuteam_participant", methods=_GET,
                         endpoint="download_dokuteam_participant_list"),
                    rule("/partial", methods=_GET,
                         endpoint="download_partial_export"),
                    rule("/csv_courses", methods=_GET,
                         endpoint="download_csv_courses"),
                    rule("/csv_lodgements", methods=_GET,
                         endpoint="download_csv_lodgements"),
                    rule("/csv_registrations", methods=_GET,
                         endpoint="download_csv_registrations"))),
                sub('/group', (
                    rule("/summary", methods=_GET,
                         endpoint="group_summary"),
                    rule("/violations", methods=_GET,
                         endpoint="constraint_violations"),
                )),
                sub('/fee', (
                    rule("/summary", methods=_GET, endpoint="fee_summary"),
                    rule("/stats", methods=_GET, endpoint="fee_stats"),
                    rule("/add", methods=_GET, endpoint="configure_fee_form"),
                    rule("/add", methods=_POST, endpoint="configure_fee"),
                    rule("/set", methods=_GET,
                         endpoint="personalized_fee_multiset_form"),
                    sub('/<int:fee_id>', (
                        rule("/change", methods=_GET, endpoint="configure_fee_form"),
                        rule("/change", methods=_POST, endpoint="configure_fee"),
                        rule("/delete", methods=_POST, endpoint="delete_fee"),
                        rule("/set", methods=_GET,
                             endpoint="personalized_fee_multiset_form"),
                        rule("/set", methods=_POST,
                             endpoint="personalized_fee_multiset"),
                    )),
                )),
                sub('/part', (
                    rule("/summary", methods=_GET,
                         endpoint="part_summary"),
                    rule("/add", methods=_GET,
                         endpoint="add_part_form"),
                    rule("/add", methods=_POST,
                         endpoint="add_part"),
                    sub('/<int:part_id>', (
                        rule("/change", methods=_GET,
                             endpoint="change_part_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_part"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_part"))),
                    sub('/group', (
                        rule("/add", methods=_GET,
                             endpoint="add_part_group_form"),
                        rule("/add", methods=_POST,
                             endpoint="add_part_group"),
                        sub('/<int:part_group_id>', (
                            rule("/change", methods=_GET,
                                 endpoint="change_part_group_form"),
                            rule("/change", methods=_POST,
                                 endpoint="change_part_group"),
                            rule("/delete", methods=_POST,
                                 endpoint="delete_part_group"),
                        )),
                    )),
                )),
                sub('/track/group', (
                    rule("/add", methods=_GET,
                         endpoint="add_track_group_form"),
                    rule("/add", methods=_POST,
                         endpoint="add_track_group"),
                    sub('/<int:track_group_id>', (
                        rule("/change", methods=_GET,
                             endpoint="change_track_group_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_track_group"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_track_group"),
                    )),
                )),
                sub('/course', (
                    rule("/list", methods=_GET,
                         endpoint="course_list"),
                    rule("/stats", methods=_GET,
                         endpoint="course_stats"),
                    rule("/create", methods=_GET,
                         endpoint="create_course_form"),
                    rule("/create", methods=_POST,
                         endpoint="create_course"),
                    rule("/query", methods=_GET,
                         endpoint="course_query"),
                    rule("/choices", methods=_GET,
                         endpoint="course_choices_form"),
                    rule("/choices", methods=_POST,
                         endpoint="course_choices"),
                    rule("/checks", methods=_GET,
                         endpoint="course_assignment_checks"),
                    sub('/<int:course_id>', (
                        rule("/show", methods=_GET,
                             endpoint="show_course"),
                        rule("/change", methods=_GET,
                             endpoint="change_course_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_course"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_course"),
                        rule("/manage", methods=_GET,
                             endpoint="manage_attendees_form"),
                        rule("/manage", methods=_POST,
                             endpoint="manage_attendees"),
                    )),
                )),
                sub('/registration', (
                    rule("/add", methods=_GET,
                         endpoint="add_registration_form"),
                    rule("/add", methods=_POST,
                         endpoint="add_registration"),
                    rule("/query", methods=_GET,
                         endpoint="registration_query"),
                    rule("/status", methods=_GET,
                         endpoint="registration_status"),
                    rule("/qr", methods=_GET,
                         endpoint="registration_fee_qr"),
                    rule("/amend", methods=_GET,
                         endpoint="amend_registration_form"),
                    rule("/amend", methods=_POST,
                         endpoint="amend_registration"),
                    rule("/questionnaire", methods=_GET,
                         endpoint="additional_questionnaire_form"),
                    rule("/questionnaire", methods=_POST,
                         endpoint="additional_questionnaire"),
                    rule("/quick", methods=_GET,
                         endpoint="quick_show_registration"),
                    rule("/list", methods=_GET,
                         endpoint="participant_list"),
                    rule("/multiedit", methods=_GET,
                         endpoint="change_registrations_form"),
                    rule("/multiedit", methods=_POST,
                         endpoint="change_registrations"),
                    sub('/<int:registration_id>', (
                        rule("/show", methods=_GET,
                             endpoint="show_registration"),
                        sub('/fee', (
                            rule("/summary", methods=_GET,
                                 endpoint="show_registration_fee"),
                            rule("/add", methods=_GET,
                                 endpoint="add_new_personalized_fee_form"),
                            rule("/add", methods=_POST,
                                 endpoint="add_new_personalized_fee"),
                            sub('/<int:fee_id>', (
                                rule('/add', methods=_POST,
                                     endpoint="add_personalized_fee"),
                                rule('/delete', methods=_POST,
                                     endpoint="delete_personalized_fee"),
                            )),
                        )),
                        rule("/change", methods=_GET,
                             endpoint="change_registration_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_registration"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_registration"),
                    )),
                )),
                sub('/lodgement', (
                    rule("/overview", methods=_GET,
                         endpoint="lodgements"),
                    rule("/create", methods=_GET,
                         endpoint="create_lodgement_form"),
                    rule("/create", methods=_POST,
                         endpoint="create_lodgement"),
                    rule("/query", methods=_GET,
                         endpoint="lodgement_query"),
                    sub('/group', (
                        rule("/summary", methods=_GET,
                             endpoint="lodgement_group_summary_form"),
                        rule("/summary", methods=_POST,
                             endpoint="lodgement_group_summary"),
                        sub('/<int:group_id>', (
                            rule("/move", methods=_GET,
                                 endpoint="move_lodgements_form"),
                            rule("/move", methods=_POST,
                                 endpoint="move_lodgements"),
                        )),
                    )),
                    sub('/graph', (
                        rule("/show", methods=_GET,
                             endpoint="lodgement_wishes_graph"),
                        rule("/form", methods=_GET,
                             endpoint="lodgement_wishes_graph_form"),
                    )),
                    sub('/<int:lodgement_id>', (
                        rule("/change", methods=_GET,
                             endpoint="change_lodgement_form"),
                        rule("/change", methods=_POST,
                             endpoint="change_lodgement"),
                        rule("/delete", methods=_POST,
                             endpoint="delete_lodgement"),
                        rule("/manage", methods=_GET,
                             endpoint="manage_inhabitants_form"),
                        rule("/manage", methods=_POST,
                             endpoint="manage_inhabitants"),
                        rule("/swap", methods=_POST,
                             endpoint="swap_inhabitants"),
                        rule("/show", methods=_GET,
                             endpoint="show_lodgement"),
                    )),
                )),
                sub('/field', (
                    rule("/setselect", methods=_GET,
                         endpoint="field_multiset_select"),
                    rule("/summary", methods=_GET,
                         endpoint="field_summary_form"),
                    rule("/summary", methods=_POST,
                         endpoint="field_summary"),
                    sub('/<int:field_id>', (
                        rule("/set", methods=_GET,
                             endpoint="field_multiset_form"),
                        rule("/set", methods=_POST,
                             endpoint="field_multiset"),
                    )),
                )),
            )),
        )),
    )),
    werkzeug.routing.EndpointPrefix('assembly/', (
        sub('/assembly', (
            rule("/", methods=_GET,
                 endpoint="index"),
            rule("/verify_result.pyz", methods=_GET,
                 endpoint="download_verify_result_script"),
            rule('/search/user', methods=_GET,
                 endpoint="user_search"),
            rule("/user/create", methods=_GET,
                 endpoint="create_user_form"),
            rule("/user/create", methods=_POST,
                 endpoint="create_user"),
            rule("/assembly/create", methods=_GET,
                 endpoint="create_assembly_form"),
            rule("/assembly/create", methods=_POST,
                 endpoint="create_assembly"),
            rule("/log", methods=_GET,
                 endpoint="view_log"),
            sub('/assembly/<int:assembly_id>', (
                rule("/show", methods=_GET,
                     endpoint="show_assembly"),
                rule("/presider/add", methods=_POST,
                     endpoint="add_presiders"),
                rule("/presider/remove", methods=_POST,
                     endpoint="remove_presider"),
                rule("/delete", methods=_POST,
                     endpoint="delete_assembly"),
                rule("/log", methods=_GET,
                     endpoint="view_assembly_log"),
                rule("/change", methods=_GET,
                     endpoint="change_assembly_form"),
                rule("/change", methods=_POST,
                     endpoint="change_assembly"),
                rule("/ml/create", methods=_POST,
                     endpoint="create_assembly_mailinglist"),
                rule("/signup", methods=_POST,
                     endpoint="signup"),
                rule("/signup/external", methods=_POST,
                     endpoint="external_signup"),
                rule("/attachments", methods=_GET,
                     endpoint="list_attachments"),
                rule("/attendees", methods=_GET,
                     endpoint="list_attendees"),
                rule("/attendees/download", methods=_GET,
                     endpoint="download_list_attendees"),
                rule("/conclude", methods=_POST,
                     endpoint="conclude_assembly"),
                sub("/attachment", (
                    rule("/add", methods=_GET,
                         endpoint="add_attachment_form"),
                    rule("/add", methods=_POST,
                         endpoint="add_attachment"),
                    rule("/cached/<filename:attachment_hash>", methods=_GET,
                     endpoint="get_cached_attachment"),
                    sub("/<int:attachment_id>", (
                        rule("/latest", methods=_GET,
                             endpoint="get_attachment"),
                        # allow this simple link for convenience
                        rule("/", endpoint="",
                             redirect_to='assembly/assembly/<assembly_id>/attachment'
                                         '/<attachment_id>/latest'),
                        # this is kept as legacy support
                        rule("/get", endpoint="",
                             redirect_to='assembly/assembly/<assembly_id>/attachment'
                                         '/<attachment_id>/latest'),
                        rule("/delete", methods=_POST,
                             endpoint="delete_attachment"),
                        rule("/add", methods=_GET,
                             endpoint="add_attachment_version_form"),
                        rule("/add", methods=_POST,
                             endpoint="add_attachment_version"),
                        sub("/version/<int:version_nr>", (
                            rule("/", methods=_GET,
                                 endpoint="get_attachment_version"),
                            # this is kept as legacy support
                            rule("/get", endpoint="",
                                 redirect_to="assembly/assembly/<assembly_id>"
                                             "/attachment/<attachment_id>/version"
                                             "/<version_nr>"),
                            rule("/change", methods=_GET,
                                 endpoint="change_attachment_version_form"),
                            rule("/change", methods=_POST,
                                 endpoint="change_attachment_version"),
                            rule("/delete", methods=_POST,
                                 endpoint="delete_attachment_version"),
                        )),
                    )),
                )),
                rule("/ballot/list", methods=_GET,
                     endpoint="list_ballots"),
                rule("/ballot/create", methods=_GET,
                     endpoint="create_ballot_form"),
                rule("/ballot/create", methods=_POST,
                     endpoint="create_ballot"),
                rule("/ballot/summary", methods=_GET,
                     endpoint="summary_ballots"),
                rule("/ballot/reschedule", methods=_GET,
                     endpoint="reschedule_ballots_form"),
                rule("/ballot/reschedule", methods=_POST,
                     endpoint="reschedule_ballots"),
                sub('/ballot/<int:ballot_id>', (
                    rule("/show", methods=_GET,
                         endpoint="show_ballot"),
                    rule("/change", methods=_GET,
                         endpoint="change_ballot_form"),
                    rule("/change", methods=_POST,
                         endpoint="change_ballot"),
                    rule("/comment", methods=_GET,
                         endpoint="comment_concluded_ballot_form"),
                    rule("/comment", methods=_POST,
                         endpoint="comment_concluded_ballot"),
                    rule("/delete", methods=_POST,
                         endpoint="delete_ballot"),
                    rule("/start", methods=_POST,
                         endpoint="ballot_start_voting"),
                    rule("/vote", methods=_POST,
                         endpoint="vote"),
                    rule("/result", methods=_GET,
                         endpoint="show_ballot_result"),
                    rule("/result", methods=_POST,
                         endpoint="show_old_vote"),
                    rule("/result/download", methods=_GET,
                         endpoint="get_result"),
                    sub("/attachment", (
                        sub("/<int:attachment_id>", (
                            # this is kept as legacy support
                            rule("/get", endpoint="",
                                 redirect_to='assembly/assembly/<assembly_id>'
                                             '/attachment/<attachment_id>/latest'),
                            sub("/version/<int:version>", (
                                # this is kept as legacy support
                                rule("/get", endpoint="",
                                     redirect_to="assembly/assembly/<assembly_id>"
                                                 "/attachment/<attachment_id>/version"
                                                 "/<version>"),
                            )),
                        )),
                    )),
                    rule("/candidates/edit", methods=_POST,
                         endpoint="edit_candidates"),
                    rule("/template", methods=_GET,
                         endpoint="ballot_template"),
                    rule("/template/redirect", methods=_GET,
                         endpoint="ballot_template_redirect"),
                )),
            )),
        )),
    )),
    werkzeug.routing.EndpointPrefix('ml/', (
        sub('/ml', (
            rule("/", methods=_GET,
                 endpoint="index"),
            rule('/search/user', methods=_GET,
                 endpoint="user_search"),
            sub("/user", (
                rule("/create", methods=_GET,
                     endpoint="create_user_form"),
                rule("/create", methods=_POST,
                     endpoint="create_user"),
                rule("/merge", methods=_GET,
                     endpoint="merge_accounts_form"),
                rule("/merge", methods=_POST,
                     endpoint="merge_accounts"))),
            rule("/mailinglist/refresh", methods=_POST,
                 endpoint="manually_write_subscription_states"),
            rule("/mailinglist/sync", methods=_POST,
                 endpoint="manual_mailman_sync"),
            rule("/mailinglist/list", methods=_GET,
                 endpoint="list_mailinglists"),
            rule("/mailinglist/moderated", methods=_GET,
                 endpoint="moderated_mailinglists"),
            rule("/mailinglist/create", methods=_GET,
                 endpoint="create_mailinglist_form"),
            rule("/mailinglist/create", methods=_POST,
                 endpoint="create_mailinglist"),
            rule("/log", methods=_GET,
                 endpoint="view_log"),
            sub('/mailinglist/<int:mailinglist_id>', (
                rule("/show", methods=_GET,
                     endpoint="show_mailinglist"),
                rule("/change", methods=_GET,
                     endpoint="change_mailinglist_form"),
                rule("/change", methods=_POST,
                     endpoint="change_mailinglist"),
                rule("/type/change", methods=_GET,
                     endpoint="change_ml_type_form"),
                rule("/type/change", methods=_POST,
                     endpoint="change_ml_type"),
                rule("/delete", methods=_POST,
                     endpoint="delete_mailinglist"),
                rule("/log", methods=_GET,
                     endpoint="view_ml_log"),
                rule("/management", methods=_GET,
                     endpoint="management"),
                rule("/moderate", methods=_GET,
                     endpoint="message_moderation_form"),
                rule("/moderate", methods=_POST,
                     endpoint="message_moderation"),
                rule("/moderate/multi", methods=_POST,
                     endpoint="message_moderation_multi"),
                rule("/management/advanced", methods=_GET,
                     endpoint="advanced_management"),
                rule("/roster", methods=_GET,
                     endpoint="show_roster"),
                rule("/download/subscriptions", methods=_GET,
                     endpoint="download_csv_subscription_states"),
                rule("/force/add", methods=_POST,
                     endpoint="add_subscription_overrides"),
                rule("/force/remove", methods=_POST,
                     endpoint="remove_subscription_override"),
                rule("/block/add", methods=_POST,
                     endpoint="add_unsubscription_overrides"),
                rule("/block/remove", methods=_POST,
                     endpoint="remove_unsubscription_override"),
                rule("/moderator/add", methods=_POST,
                     endpoint="add_moderators"),
                rule("/moderator/remove", methods=_POST,
                     endpoint="remove_moderator"),
                rule("/whitelist/add", methods=_POST,
                     endpoint="add_whitelist"),
                rule("/whitelist/remove", methods=_POST,
                     endpoint="remove_whitelist"),
                rule("/requests/handle", methods=_POST,
                     endpoint="handle_request"),
                rule("/subscriptions/add", methods=_POST,
                     endpoint="add_subscribers"),
                rule("/subscriptions/remove", methods=_POST,
                     endpoint="remove_subscriber"),
                rule("/subscriptions/readd", methods=_POST,
                     endpoint="readd_subscriber"),
                rule("/subscriptions/reset", methods=_POST,
                     endpoint="reset_unsubscription"),
                rule("/subscriptions/self/add", methods=_POST,
                     endpoint="subscribe"),
                rule("/subscriptions/self/remove", methods=_POST,
                     endpoint="unsubscribe"),
                rule("/subscriptions/self/request", methods=_POST,
                     endpoint="request_subscription"),
                rule("/subscriptions/self/cancel", methods=_POST,
                     endpoint="cancel_subscription"),
                rule("/subaddress/change", methods=_POST,
                     endpoint="change_address"),
                rule("/subaddress/confirm", methods=_GET,
                     endpoint="do_address_change"))),
        )),)),
), converters={'filename': FilenameConverter})
