\BLOCK{ extends "tex/event/base_article.tmpl" }
\BLOCK{ block documentclass }
    \documentclass[12pt,portrait,parskip=half+,a5paper]{scrartcl}
\BLOCK{ endblock }

\BLOCK{ block extra_preamble }

    \parindent 0pt\relax
    \pagestyle{empty}
    \usepackage{calc}
    \newcommand{\debugbox}{}
    \newcommand{\logosize}{0.2}

\BLOCK{ endblock }
\BLOCK{ block content }
    \BLOCK{ for course_id, course in courses|xdictsort('nr', pad=True) }
        \BLOCK{ for track_id in tracks_sorted if track_id in course['active_segments'] }
        \BLOCK{ set key = (course_id, track_id) }
            \begin{minipage}[c][\logosize\linewidth][c]{0.8\linewidth}
                \raggedright
                \Huge\textbf{\VAR{ course['shortname']|te }}\\
                \normalsize \VAR{ course['title']|te }\\
                \BLOCK{ if ambience['event']['tracks']|length > 1 -}
                    \emph{\VAR{ ambience['event']['tracks'][track_id]['shortname']|te }}\\
                \BLOCK{- endif }
                \VAR{ (attendees[key]|length - instructors[key]|length)|te } \BLOCK{ trans } Teilnehmer \BLOCK{ endtrans }
                , \VAR{ instructors[key]|length|te } \BLOCK{ trans } Kursleiter \BLOCK{ endtrans }
            \end{minipage}
            \begin{minipage}[c][\logosize\textwidth][t]{\logosize\linewidth}
                \includegraphics[keepaspectratio=true, width=\textwidth,height=\textwidth]{./course-logo-\VAR{ course_id|te }}
            \end{minipage}
            \begin{itemize}
                \BLOCK{ for reg_id, reg in registrations.items() if reg_id in attendees[(course_id, track_id)] }
                    \BLOCK{ with p = personas[registrations[reg_id]['persona_id']] }
                        \item
                            \BLOCK{ if reg_id in instructors[(course_id, track_id)] }
                                \emph{
                                    \VAR{- personas[registrations[reg_id]['persona_id']]['given_names']|te }
                                    \VAR{ personas[registrations[reg_id]['persona_id']]['family_name']|te -}
                                }
                            \BLOCK{ else }
                                \VAR{- personas[registrations[reg_id]['persona_id']]['given_names']|te }
                                \VAR{ personas[registrations[reg_id]['persona_id']]['family_name']|te -}
                                \BLOCK{ if p['age'].is_minor() }
                                    \fbox{\VAR{ p['age'].name|upper|te }}
                                \BLOCK{ endif }
                            \BLOCK{ endif }
                    \BLOCK{ endwith }
                \BLOCK{ else }
                    \item \emph{\BLOCK{ trans } niemand \BLOCK{ endtrans }}
                \BLOCK{ endfor }
            \end{itemize}
            \vspace{\fill}
            \begin{minipage}[t]{\textwidth}
                \BLOCK{ if course_room_field -}
                    \BLOCK{ trans } Kursraum \BLOCK{ endtrans }: \VAR{ course['fields'].get(course_room_field, "")|te }
                \BLOCK{- endif }
            \end{minipage}
            \clearpage
        \BLOCK{ endfor }
    \BLOCK{ endfor }
\BLOCK{ endblock }
