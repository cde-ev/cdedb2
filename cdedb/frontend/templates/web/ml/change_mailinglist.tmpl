{% set sidenav_active='ml_change' %}
{% extends "web/ml/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block scripts %}{{ util.cdedb_script('cdedb_helper.js') }}{{ util.cdedb_script('cdedb_change_mailinglist.js') }}{% endblock %}
{% set jshint='weak' %}
{% block title %}
    {% trans title=ambience['mailinglist']['title'] -%}
        {{ title }} â€“ Configuration
    {%- endtrans %}
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("ml/show_mailinglist"), ambience['mailinglist']['title'], icon="envelope") }}
{{ util.breadcrumb_link(cdedblink("ml/change_mailinglist"), gettext("Configuration"), active=True) }}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans -%}Configuration{%- endtrans %}
        <small>
            {{- util.make_icon('envelope', arialabel="Mailingliste") }} {{ ambience['mailinglist']['title'] -}}
        </small>
    </h1>
{% endblock %}
{% block content %}
    <script type="text/javascript" nonce="{{ csp_nonce }}">
        $(function() {
            $('#changelistform').cdedbProtectChanges().cdedbChangeMailinglist();
        });
    </script>
    {% if is_admin %}
        <form action="{{ cdedblink('ml/change_mailinglist') }}" method="POST" id="changelistform" class="form-horizontal">
            {{ util.anti_csrf_token('ml/change_mailinglist') }}
    {% else %}
        <div id="changelistform">
    {% endif %}
        <h4 class="heading-underline">{% trans -%}Meta{%- endtrans %}</h4>
            {{ util.form_input_checkbox(name="is_active", label=gettext("Active"), readonly=not is_admin) }}
            {{ util.form_input_text(name="title", label=gettext("Title"), readonly=not is_admin) }}
            {{ util.form_input_text(name="address", label=gettext("Address"), readonly=not is_admin) }}
            {{ util.form_input_textarea(name="description", label=gettext("Description"), rows="5", readonly=not is_admin,
                                        info=gettext("Supports %(infolink)s.")|format(
                                            infolink=util.href(docurl("Handbuch_Markdown"), gettext("Markdown"),
                                                               title=gettext("Short Markdown summary")))|s) }}
            {{ util.form_input_textarea(name="notes", label=gettext("Admin-Notes"), rows="5", readonly=not is_admin,
                                        info=gettext("Supports %(infolink)s.")|format(
                                            infolink=util.href(docurl("Handbuch_Markdown"), gettext("Markdown"),
                                                               title=gettext("Short Markdown summary")))|s) }}

        <h4 class="heading-underline">{% trans -%}Moderation & Subscribers{%- endtrans %}</h4>
            {{ util.form_input_select(name="mod_policy", label=gettext("Moderation"), readonly=not is_admin,
                    entries=enums['ModerationPolicy']|enum_entries(processing=gettext)) }}
            {{ util.form_input_select(name="audience_policy", label=gettext("Audience"), readonly=not is_admin,
                    entries=enums['AudiencePolicy']|enum_entries(processing=gettext)) }}
            {{ util.form_input_select(name="sub_policy", label=gettext("Subscription"), readonly=not is_admin,
                    entries=enums['SubscriptionPolicy']|enum_entries(processing=gettext)) }}
            {{ util.form_input_select(name="event_id", label=gettext("Event"), nulloption="", entries=sorted_events,
                    readonly=not is_admin,
                    info=gettext("The participants of this event will be subscribers of this mailinglist. (Opt-Out)")) }}
            {{ util.form_input_checkboxes(name="registration_stati", label=gettext("Event Audience"), readonly=not is_admin,
                    entries=enums['RegistrationPartStati']|enum_entries(processing=gettext),
                    info=gettext("No selection results in an orga-list.")) }}
            {{ util.form_input_select(name="assembly_id", label=gettext("Assembly"), nulloption="", readonly=not is_admin,
                    entries=sorted_assemblies,
                    info=gettext("The participants of this assembly will be subscribers of this mailinglist. (Opt-Out)")) }}

        <h4 class="heading-underline">{% trans -%}Mails{%- endtrans %}</h4>
            {{ util.form_input_text(name="subject_prefix", label=gettext("Subject Prefix"), readonly=not is_admin) }}
            {{ util.form_input_select(name="attachment_policy", label=gettext("MIME filter / Attachments"), readonly=not is_admin,
                    entries=enums['AttachmentPolicy']|enum_entries(processing=gettext)) }}
            {{ util.form_input_text(name="maxsize", label=gettext("max. message size (in kB)"), readonly=not is_admin) }}
    {% if is_admin %}
            {{ util.form_input_submit(value=gettext("Save"), cancellink=cdedblink('ml/show_mailinglist')) }}
        </form>
    {% else %}
        </div>
    {% endif %}
{% endblock %}
