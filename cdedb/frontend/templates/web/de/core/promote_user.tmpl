{% extends "web/de/core/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}
   {% with p = ambience['persona'] %}
        {% if values['target_realm'] %}
            {{ p['given_names']|e }} {{ p['family_name']|e }} Bereich {{ values['target_realm']|e }} hinzufügen
        {% else %}
            Bereichsänderung für {{ p['given_names']|e }} {{ p['family_name']|e }}
        {% endif %}
    {% endwith %}
{% endblock %}
{% block breadcrumb %}
    {{ util.breadcrumb_link(cdedblink("core/index"), "Start") }}
    {{ util.breadcrumb_link(show_user_link(ambience['persona']['id']),
            ambience['persona']['given_names'] + " " + ambience['persona']['family_name'], icon="user") }}
    {{ util.breadcrumb_link(cdedblink("core/promote_user_form"), "Bereich hinzufügen",
            active=(values['target_realm'] == '')) }}
    {% if values['target_realm'] %}
        {{ util.breadcrumb_link(cdedblink("core/promote_user_form"), "Bestätigung", active=True) }}
    {% endif %}
{% endblock %}
{% block content %}
   {% with p = ambience['persona'] %}
        {% if not values['target_realm'] %}
            <form action="{{ cdedblink('core/promote_user_form')|e }}" method="GET" id="realmselectionform"
                    class="form-horizontal">
                <div>
                    {# jinja does not support list comprehension ... #}
                    {% set myentries = [] %}
                    {% for realm, description in (('cde', 'CdE'), ('event', 'Veranstaltung'), ('ml', 'Mailinglisten'),
                                                  ('assembly', 'Versammlung')) %}
                        {% if not p['is_{}_realm'.format(realm)] %}
                            {{ myentries.append((realm, description))|e }}
                        {% endif %}
                    {% endfor %}
                    {{ util.form_input_checkboxes(name="target_realm", entries=myentries, label="Zielbereich", radio=True) }}
                    {{ util.form_input_submit(value="Bereich wählen") }}
                </div>
            </form>
        {% else %}
            <p>
                Diese Operation fügt gegebenenfalls implizit weitere Bereiche hinzu. Im konkreten Fall sind diese in
                der folgenden (möglicherweise leeren) Liste zu finden.
                <ul>
                    {# TODO include in above text and display only if not already in this realm #}
                    {% if target_realm == 'cde' %}
                        <li>Veranstaltung</li>
                        <li>Versammlung</li>
                    {% endif %}
                    {% if target_realm in ('cde', 'event', 'assembly') %}
                        <li>Mailinglisten</li>
                    {% endif %}
                </ul>
            </p>
            <h3>Zusätzliche Daten</h3>
            <form action="{{ cdedblink('core/promote_user')|e }}" method="POST" id="promotionform" class="form-horizontal">
                {{ util.input_hidden(name="target_realm") }}
                {% if not (p['is_cde_realm'] or p['is_event_realm']) and values['target_realm'] in ('cde', 'event')  %}
                    {{ util.form_input_text(name="title", label="Titel") }}
                    {{ util.form_input_text(name="name_supplement", label="Namenszusatz") }}
                    {{ util.form_input_text(name="birthday", label="Geburtstag") }}
                    {{ util.form_input_select(name="gender", entries=default_selections['gender'], label="Geschlecht") }}
                {% endif %}
                {% if not p['is_cde_realm'] and values['target_realm'] == 'cde'  %}
                    {{ util.form_input_textarea(name="free_form", label="Sonstiges", rows="5") }}
                {% endif %}
                {% if not (p['is_cde_realm'] or p['is_event_realm']) and values['target_realm'] in ('cde', 'event')  %}
                    {{ util.form_input_text(name="telephone", label="Telefon") }}
                    {{ util.form_input_text(name="mobile", label="Mobiltelefon") }}
                    {{ util.form_input_text(name="address", label="Straße") }}
                    {{ util.form_input_text(name="address_supplement", label="Addresszusatz") }}
                    {{ util.form_input_text(name="postal_code", label="Postleitzahl") }}
                    {{ util.form_input_text(name="location", label="Stadt") }}
                    {{ util.form_input_text(name="country", label="Land") }}
                {% endif %}
                {{ util.form_input_submit(value="Bereich hinzufügen", cancellink=show_user_link(ambience['persona']['id'])) }}
            </form>
        {% endif %}
    {% endwith %}
{% endblock %}
