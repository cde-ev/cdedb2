{% set sidenav_active='cde_member_search' %}
{% extends "web/de/cde/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}Mitgliedersuche{% endblock %}
{% block content %}
    <h3>Suchmaske</h3>
    <form action="{{ cdedblink('cde/member_search')|e }}" method="GET" id="membersearchform">
        {# This is mostly an inlined version of util.format_query(...) but customized for this special query page. #}
        <table>
            <tr {% if "fulltext" in errors %} class="errorInput" {% endif %} >

                <td> Volltext </td>
                <td> <input type="text" name="qval_fulltext", value="" > </td>
            </tr>
            <tr {% if "family_name,birth_name" in errors %} class="errorInput" {% endif %} >

                <td> Nachname </td>
                <td> <input type="text" name="qval_family_name,birth_name", value="" > </td>
            </tr>
            <tr {% if "given_names,display_name" in errors %} class="errorInput" {% endif %} >

                <td> Vorname </td>
                <td> <input type="text" name="qval_given_names,display_name", value="" > </td>
            </tr>
            <tr {% if "username" in errors %} class="errorInput" {% endif %} >

                <td> Email </td>
                <td> <input type="text" name="qval_username", value="" > </td>
            </tr>
            <tr {% if "telephone,mobile" in errors %} class="errorInput" {% endif %} >

                <td> Telefon </td>
                <td> <input type="text" name="qval_telephone,mobile", value="" > </td>
            </tr>
            <tr {% if "address,address_supplement,address2,address_supplement2" in errors %}
                    class="errorInput" {% endif %}>

                <td> Adresse </td>
                <td>
                    <input type="text" name="qval_address,address_supplement,address2,address_supplement2", value="">
                </td>
            </tr>
            <tr {% if "postal_code,postal_code2" in errors %} class="errorInput" {% endif %} >

                <td> PLZ </td>
                <td> <input type="text" name="qval_postal_code,postal_code2", value="" > </td>
            </tr>
            <tr {% if "location,location2" in errors %} class="errorInput" {% endif %} >

                <td> Ort </td>
                <td> <input type="text" name="qval_location,location2", value="" > </td>
            </tr>
            <tr {% if "country,country2" in errors %} class="errorInput" {% endif %} >

                <td> Land </td>
                <td> <input type="text" name="qval_country,country2", value="" > </td>
            </tr>
            <tr {% if "weblink,specialisation,affiliation,timeline,interests,free_form" in errors %}
                    class="errorInput" {% endif %} >

                <td> Interessen, Werdegang, ... </td>
                <td>
                    <input type="text" name="qval_weblink,specialisation,affiliation,timeline,interests,free_form",
                     value="">
                </td>
            </tr>
            <tr>

                <td> Akademie </td>
                <td>
                    <select name="qval_pevent_id" >
                        <option value="" > </option>
                        {% for key in choices['pevent_id']|sort %}
                            <option value="{{ key|e }}"
                             {% if values.get('qval_pevent_id') == key|string %} selected {% endif %} >
                                {{ choices['pevent_id'][key]|e }}
                            </option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td> Kurs </td>
                <td>
                    <select name="qval_pcourse_id" >
                        <option value="" > </option>
                        {% for key in choices['pcourse_id']|sort %}
                            <option value="{{ key|e }}"
                             {% if values.get('qval_pcourse_id') == key|string %} selected {% endif %} >
                                {{ choices['pcourse_id'][key]|e }}
                            </option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
        </table>
        <div>
            {{ util.input_hidden(name="is_search", value=True) }}
            {{ util.form_input_submit(value="Suchen") }}
        </div>
    </form>
    {% if values['is_search'] %}
        <h3>Ergebnis -- {{ result|length|e }} {{ result|length|numerus("Mitglied", "Mitglieder")|e }} gefunden</h3>
        {% for dataset in result %}
            <p>
                {{ util.href(show_user_link(dataset['id']),
                             "{} {}".format(dataset['family_name'], dataset['given_names'])) }}
            </p>
        {% endfor %}
    {% endif %}
{% endblock %}
