{% extends "web/de/cde/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}{{ ambience['pevent']['title']|e }}{% endblock %}
{% block content %}
    {% if is_admin %}
        {{ util.href(cdedblink('cde/change_past_event_form'), "Bearbeiten") }}
        {{ util.href(cdedblink('cde/create_past_course_form'), "Kurs hinzufügen") }}
        <form action="{{ cdedblink('cde/add_participant')|e }}" method="POST" id="addparticipantform">
            {{ util.form_input_text(name="persona_id", label="ID") }}
            {{ util.input_hidden(name="pcourse_id", value="") }}
            {{ util.input_hidden(name="is_instructor", value=False) }}
            {{ util.form_input_checkbox(name="is_orga", label="Orga") }}
            {{ util.form_input_submit(value="Teilnehmer (ohne Kurs) hinzufügen") }}
        </form>
    {% endif %}
    <p>Kürzel: {{ ambience['pevent']['shortname']|e }}</p>
    <p>Organisation: {{ institutions[ambience['pevent']['institution']]|e }}</p>
    <p>{{ ambience['pevent']['description']|e }}</p>
    {% if courses %}
        <h2>Kurse</h2>
        <ul>
            {% for anid, title in courses|dictsort %}
                <li>{{ util.href(cdedblink('cde/show_past_course', {'pcourse_id' : anid}), title) }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if participants %}
        <h2>Teilnehmer</h2>
        <ul>
            {% for anid, pdata in participants.items() %} {# This dict is already sorted. #}
                <li>
                    {% if pdata['is_orga'] %}
                        <strong>
                    {% endif %}
                    {{ personas[anid]['given_names']|e }} {{ personas[anid]['family_name']|e }}
                    {% if pdata['is_orga'] %}
                        </strong>
                    {% endif %}
                    {# only allow removal of participants without a course #}
                    {% if is_admin and pdata['pcourse_id'] is none %}
                        <form action="{{ cdedblink('cde/remove_participant')|e }}" method="POST"
                         id="removeparticipantform{{ anid|e }}">
                            {{ util.input_hidden(name="persona_id", value=anid) }}
                            {{ util.input_hidden(name="pcourse_id", value=pdata['pcourse_id']) }}
                            {{ util.input_hidden(name="course_page", value=False) }}
                            {{ util.form_input_submit(value="entfernen") }}
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}
