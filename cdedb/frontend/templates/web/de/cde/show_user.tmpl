{% extends "web/de/cde/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}{{ data['given_names']|e }} {{ data['family_name']|e }}{% endblock %}
{% block content %}
    <h1>{{ data['given_names']|e }} {{ data['family_name']|e }}</h1>
    {% if data['id'] == user.persona_id or is_admin %}
        <p>
            <a href="{{ cdedblink('cde/change_user_form') }}">Bearbeiten</a>
            <a href="{{ cdedblink('cde/set_foto_form') }}">Profilbild ändern</a>
        </p>
    {% endif %}
    {% if foto %}
       <img src="{{ cdedblink('cde/get_foto', {'foto' : foto})}}" alt="Profilbild" class="profilepic">
    {% else %}
       <img src="{{ staticurl("generic-avatar.png") }}" alt="Standardprofilbild" class="profilepic">
    {% endif %}
    <table>
        <th>
            <tr> <td colspan="2">Person</td> </tr>
        </th>
        <tr>
            <td>Name</td>
            <td>{{ data['title']|e }} {{ data['given_names']|e }} {{ data['family_name']|e }} {{ data['name_supplement']|e }}</td>
        </tr>
        <tr>
            <td>Rufname</td>
            <td>{{ data['display_name']|e }}</td>
        </tr>
        <tr>
            <td>Geburtsname</td>
            <td>{{ data['birth_name']|e }}</td>
        </tr>
        <tr>
            <td>Geburtstag</td>
            <td>{{ data['birthday']|date|e }}</td>
        </tr>
        <tr>
            <td>Geschlecht</td>
            <td>{{ data['gender']|gender|e }}</td>
        </tr>
        <tr>
            <td>Fachgebiet</td>
            <td>{{ data['specialisation']|e }}</td>
        </tr>
        <tr>
            <td>Schule, Uni, ...</td>
            <td>{{ data['affiliation']|e }}</td>
        </tr>
        <tr>
            <td>Jahrgang, Matrikel, ...</td>
            <td>{{ data['timeline']|e }}</td>
        </tr>
        <tr>
            <td>Interessen</td>
            <td>{{ data['interests']|e }}</td>
        </tr>
        <tr>
            <td>Sonstiges</td>
            <td>{{ data['free_form']|e }}</td>
        </tr>
        <th>
            <tr> <td colspan="2">Kontakt</td> </tr>
        </th>
        <tr>
            <td>Email</td>
            <td>{{ data['username']|e }}</td>
        </tr>
        <tr>
            <td>Telefon</td>
            <td>{{ data['telephone']|e }}</td>
        </tr>
        <tr>
            <td>Mobiltelefon</td>
            <td>{{ data['mobile']|e }}</td>
        </tr>
        <tr>
            <td>WWW</td>
            {# TODO maybe add links or so #}
            <td>{{ data['weblink']|e }}</td>
        </tr>
        <th>
            <tr> <td colspan="2">Adresse</td> </tr>
        </th>
        <tr>
            <td>Straße</td>
            <td>{{ data['address']|e }}</td>
        </tr>
        <tr>
            <td>Adresszusatz</td>
            <td>{{ data['address_supplement']|e }}</td>
        </tr>
        <tr>
            <td>Stadt</td>
            <td>{{ data['postal_code']|e }} {{ data['location']|e }}</td>
        </tr>
        <tr>
            <td>Land</td>
            <td>{{ data['country']|e }}</td>
        </tr>
        <th>
            <tr> <td colspan="2">Zweitadresse</td> </tr>
        </th>
        <tr>
            <td>Straße</td>
            <td>{{ data['address2']|e }}</td>
        </tr>
        <tr>
            <td>Adresszusatz</td>
            <td>{{ data['address_supplement2']|e }}</td>
        </tr>
        <tr>
            <td>Stadt</td>
            <td>{{ data['postal_code2']|e }} {{ data['location2']|e }}</td>
        </tr>
        <tr>
            <td>Land</td>
            <td>{{ data['country2']|e }}</td>
        </tr>
	{% if data['id'] == user.persona_id or is_admin %}
	    <th>
		<tr> <td colspan="2">Mitgliedschaft</td> </tr>
	    </th>
	    <tr>
		<td>CdE-Mitglied</td>
		<td>
		    {% if user.is_member %}
			{{ util.checkbox_checked() }}
			{% if data['trial_member'] %}
			    (Probemitgliedschaft)
			{% endif %}
		    {% else %}
			{{ util.checkbox_unchecked() }}
		    {% endif %}
		</td>
	    </tr>
	    <tr>
		<td>CdE-Wolken-Zugriff</td>
		<td>
		    {% if data['cloud_account'] %}
			{{ util.checkbox_checked() }}
		    {% else %}
			{{ util.checkbox_unchecked() }}
		    {% endif %}
		</td>
	    </tr>
	    {% if user.is_member %}
		<tr>
		    <td>Sichtbarkeit</td>
		    {% if not data['decided_search'] %}
			<td>
                            Noch nicht entschieden; Daten sind nicht sichtbar.
                            {% if data['id'] == user.persona_id %}
                                <a href="{{ cdedblink('cde/consent_decision') }}">Entscheiden.</a>
                            {% endif %}
                        </td>
		    {% else %}
		       {% if user.is_searchable %}
			   <td>Daten sind für andere Mitglieder sichtbar.</td>
		       {% else %}
			   <td>Daten sind nicht sichtbar.</td>
		       {% endif %}
		    {% endif %}
		</tr>
                <tr>
                    <td>Datenzugriff für BuB</td>
                    <td>
                        {% if data['bub_search'] %}
                            {{ util.checkbox_checked() }}
                        {% else %}
                            {{ util.checkbox_unchecked() }}
                        {% endif %}
                    </td>
                </tr>
	    {% endif %}
	    <tr>
		<td>CdEDB-ID</td>
		<td>{{ data['id']|cdedbid|e }}</td>
	    </tr>
	    <tr>
		<td>Guthaben</td>
		<td>{{ data['balance']|e }}</td>
	    </tr>
	{% endif %}
        <th>
            <tr> <td colspan="2">Veranstaltungen</td> </tr>
        </th>
        {% for info in participation_info %}
            <tr>
                <td colspan="2">
                    {{ info['event_name']|e }}
                    {% if info['is_orga'] %}
                        (Orga)
                    {% else %}
                        {% if info['course_name'] %}
                            {{ info['course_name']|e }}
                            {% if info['is_instructor'] %}
                                (Kursleiter)
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>

    {% if data['id'] == user.persona_id or is_admin %}
        <p>
            <a href="{{ cdedblink('cde/change_user_form') }}">Bearbeiten</a>
        </p>
    {% endif %}
    {% if is_admin %}
        <form action="{{ cdedblink('core/admin_password_reset', {'persona_id' : data['id']}) }}" method="POST" id="adminpasswordresetform">
            {{ util.input_submit(value="Passwort zurücksetzen") }}
        </form>
    {% endif %}
{% endblock %}
