{% set sidenav_active='event_register' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}Anmeldung zur Veranstaltung {{ ambience['event']['title']|e }}{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/register"), "Anmelden", active=True) }}
{% endblock %}
{% block content %}
    {{ util.href(cdedblink("event/index"), "Abbrechen") }}
    <p>
        {% if ambience['event']['registration_soft_limit'] >= now().date() %}
            Alle Angaben bis auf die Veranstaltungsteile können bis zum Anmeldeschluss
            ({{ ambience['event']['registration_soft_limit']|date|e }}) geändert werden.
        {% else %}
            Der Anmeldeschluss ist bereits vorbei. Deine Anmeldung wird nach Möglichkeit berücksichtigt.
        {% endif %}
    </p>
    <form action="{{ cdedblink('event/register')|e }}" method="POST" id="registerform">
        <table>
            {# jinja does not support list comprehension ... #}
            {% set myentries = [] %}
            {% for part_id, pdata in ambience['event']['parts']|dictsort %}
                {{ myentries.append((part_id, pdata['title']))|e }}
            {% endfor %}
            {{ util.form_input_checkboxes(name="parts", label="Veranstaltungsteile", entries=myentries) }}
            {% if not age.may_mix() %}
                <tr>
                    <td>Gemischte Unterbringung</td>
                    <td>
                        Keine gemischte Unterbringung.
                        {{ util.input_hidden(name="mixed_lodging", value=False) }}
                    </td>
                </tr>
            {% else %}
                {% if age.is_minor() %}
                    {% set mix_info = glue("Die Auswahl muss mit der Einverständniserklärung der",
                                           "Erziehungsberechtigten kompatibel sein.") %}
                {% else %}
                    {% set mix_info = "" %}
                {% endif %}
                {{ util.form_input_select(name="mixed_lodging", entries=(
                    (True, "Ich bin mit gemischter Unterbringung einverstanden."),
                    (False, "Ich will geschlechter-getrennt untergebracht werden.")),
                    label="Gemischte Unterbringung", info=mix_info) }}
            {% endif %}
            {{ util.form_input_checkbox(name="foto_consent", label=glue(
                    "Ich bin damit einverstanden, dass Fotos und Aufnahmen meiner Person, die im Rahmen dieser",
                    "Veranstaltung entstehen, für die Veranstaltungsdokumentation und eine CdE-interne,",
                    "passwortgeschützte Fotogalerie verwendet werden. Einzelne Fotos können auf gesonderten",
                    "Wunsch davon ausgenommen werden.")) }}
            {{ util.form_input_textarea(name="notes", label="Anmerkungen", rows="5") }}
            {% for part_id, course_list in course_choices|dictsort %}
                {% if course_list %}
                    <tr><th colspan="2">Kurswahl {{ ambience['event']['parts'][part_id]['title']|e }}</th></tr>
                    {# jinja does not support list comprehension ... #}
                    {% set myentries = [] %}
                    {% for course_id in course_list %}
                        {{ myentries.append((course_id, courses[course_id]['title']))|e }}
                    {% endfor %}
                    {{ util.form_input_select(name="course_choice{}_0".format(part_id), entries=myentries,
                                             label="Erstwahl") }}
                    {{ util.form_input_select(name="course_choice{}_1".format(part_id), entries=myentries,
                                             label="Zweitwahl") }}
                    {{ util.form_input_select(name="course_choice{}_2".format(part_id), entries=myentries,
                                             label="Drittwahl") }}
                    {# jinja does not support list comprehension ... #}
                    {% set myentries = [("", "Ich bin kein Kursleiter.")] %}
                    {% for course_id in course_list %}
                        {{ myentries.append((course_id, courses[course_id]['title']))|e }}
                    {% endfor %}
                    {{ util.form_input_select(name="course_instructor{}".format(part_id), entries=myentries,
                                             label="Kursleiter") }}
                {% endif %}
            {% endfor %}
        </table>
        <div>
             <h2>Personendaten</h2>
             <p>
                 Im Folgenden sind Deine Personendaten aufgeführt. Sollte
                 hier etwas nicht stimmen ändere dies bitte im Menüpunkt
                 &quot;Meine Daten&quot;.
             </p>
        </div>
        <table>
            <tr>
                <td>Name</td>
                <td>
                    {{ persona['title']|e }}
                    {{ persona['given_names']|e }}
                    {{ persona['family_name']|e }}
                    {{ persona['name_supplement']|e }}
                </td>
            </tr>
            <tr>
                <td>Geburtstag</td>
                <td>{{ persona['birthday']|e }}</td>
            </tr>
            <tr>
                <td>Geschlecht</td>
                <td>{{ persona['gender']|gender|e }}</td>
            </tr>
            <tr>
                <td>Email</td>
                <td> {{ persona['username']|e }} </td>
            </tr>
            <tr>
                <td>Telefon</td>
                <td>{{ persona['telephone']|e }}</td>
            </tr>
            <tr>
                <td>Mobiltelefon</td>
                <td>{{ persona['mobile']|e }}</td>
            </tr>
            <tr>
                <td>Straße</td>
                <td>{{ persona['address']|e }}</td>
            </tr>
            <tr>
                <td>Adresszusatz</td>
                <td>{{ persona['address_supplement']|e }}</td>
            </tr>
            <tr>
                <td>Stadt</td>
                <td>{{ persona['postal_code']|e }} {{ persona['location']|e }}</td>
            </tr>
            <tr>
                <td>Land</td>
                <td>{{ persona['country']|e }}</td>
            </tr>
        </table>
        <div>
            {{ util.form_input_submit(value="Anmelden") }}
        </div>
    </form>
{% endblock %}
