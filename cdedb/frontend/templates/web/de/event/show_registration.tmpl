{% set sidenav_active='event_registration' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}
Anmeldung von {{ user_data['given_names']|e }} {{ user_data['family_name']|e }} ({{ event_data['title']|e }})
{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_begin() }}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_query"), "Anmeldungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_registration"),
    user_data['given_names']|e + " " + user_data['family_name']|e, active=True, icon="user") }}
{{ util.breadcrumb_end() }}
{% endblock %}
{% block content %}
    <table>
        <tr><th colspan="2">Personendaten</th></tr>
        <tr>
            <td>Name</td>
            <td>
                {{ user_data['title']|e }}
                {{ user_data['given_names']|e }}
                {{ user_data['family_name']|e }}
                {{ user_data['name_supplement']|e }}
            </td>
        </tr>
        <tr>
            <td>CdEDB-ID</td>
            <td>{{ user_data['id']|cdedbid|e }}</td>
        </tr>
        <tr>
            <td>Online CdEDB-ID (für Offline-Registrierungen))</td>
            <td>{{ registration_data['real_persona_id']|cdedbid|e }}</td>
        </tr>
        <tr>
            <td>Mitglied</td>
            <td>{{ util.deko_checkbox(checked=(user_data['status'] in const.MEMBER_STATI)) }}</td>
        </tr>
        <tr>
            <td>Geburtstag/Altersklasse</td>
            <td>
                {{ user_data['birthday']|e }} ({{ i18n(age|string)|e }})
            </td>
        </tr>
        <tr>
            <td>Geschlecht</td>
            <td>{{ user_data['gender']|gender|e }}</td>
        </tr>
        <tr>
            <td>Email</td>
            <td> {{ user_data['username']|e }} </td>
        </tr>
        <tr>
            <td>Telefon</td>
            <td>{{ user_data['telephone']|e }}</td>
        </tr>
        <tr>
            <td>Mobiltelefon</td>
            <td>{{ user_data['mobile']|e }}</td>
        </tr>
        <tr>
            <td>Straße</td>
            <td>{{ user_data['address']|e }}</td>
        </tr>
        <tr>
            <td>Adresszusatz</td>
            <td>{{ user_data['address_supplement']|e }}</td>
        </tr>
        <tr>
            <td>Stadt</td>
            <td>{{ user_data['postal_code']|e }} {{ user_data['location']|e }}</td>
        </tr>
        <tr>
            <td>Land</td>
            <td>{{ user_data['country']|e }}</td>
        </tr>
        <tr><th colspan="2">Allgemeine Angaben</th></tr>
        <tr>
            <td>Orga</td>
            <td>
                {{ util.deko_checkbox(checked=(user_data['id'] in event_data['orgas'])) }}
            </td>
        </tr>
        <tr>
            <td>Anmerkungen</td>
            <td>{{ registration_data['notes']|rst }}</td>
        </tr>
        <tr>
            <td>Orga-Notizen</td>
            <td>{{ registration_data['orga_notes']|rst }}</td>
        </tr>
        <tr>
            <td>Teilnehmerbeitrag bezahlt am</td>
            <td>{{ registration_data['payment']|date|e }}</td>
        </tr>
        <tr>
            <td>Einverständniserklärung der Eltern</td>
            <td>
                {% if not age.is_minor() %}
                    volljährig
                {% else %}
                    {{ util.deko_checkbox(checked=registration_data['parental_agreement']) }}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>Gemischte Unterbringung</td>
            <td>
                {{ util.deko_checkbox(checked=registration_data['mixed_lodging']) }}
            </td>
        </tr>
        <tr>
            <td>Checkin</td>
            <td>{{ registration_data['checkin']|datetime|e }}</td>
        </tr>
        <tr>
            <td>Foto-Einwilligung</td>
            <td>
                {{ util.deko_checkbox(checked=registration_data['foto_consent']) }}
            </td>
        </tr>
        {% for part_id, pdata in event_data['parts']|dictsort %}
            <tr><th colspan="2">{{ pdata['title']|e }}</th></tr>
            <tr>
                <td>Status</td>
                <td>
                    {{ i18n(registration_data['parts'][part_id]['status']|enum(const.RegistrationPartStati))|e }}
                </td>
            </tr>
            <tr>
                <td>Kurs</td>
                <td>
                    {% if registration_data['parts'][part_id]['course_id'] %}
                        {{ course_data[registration_data['parts'][part_id]['course_id']]['title']|e }}
                    {% endif %}
                </td>
            </tr>
            {% for prio in ("Erstwahl", "Zweitwahl", "Drittwahl",) %}
                <tr>
                    <td>{{ prio|e }}</td>
                    <td>
                        {% if registration_data['choices'].get(part_id, [])|length > loop.index0  %}
                            {{ course_data[registration_data['choices'][part_id][loop.index0]]['title']|e }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            <tr>
                <td>Kursleiter</td>
                <td>
                    {% if registration_data['parts'][part_id]['course_instructor'] %}
                        {{ course_data[registration_data['parts'][part_id]['course_instructor']]['title']|e }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Unterkunft</td>
                <td>
                    {% if registration_data['parts'][part_id]['lodgement_id'] %}
                        {{ lodgement_data[registration_data['parts'][part_id]['lodgement_id']]['moniker']|e }}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        <tr><th colspan="2">Felder</th></tr>
        {% for field_id, fdata in event_data['fields']|dictsort %}
            <tr>
                <td>{{ fdata['field_name']|e }}</td>
                <td>
                    {% if fdata['entries'] %}
                        {% for value, description in fdata['entries'] %}
                            {% if registration_data['field_data'].get(fdata['field_name']) == value %}
                                {{ description|e }}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% if fdata['kind'] == "bool" %}
                            {{ util.deko_checkbox(checked=registration_data['field_data'].get(fdata['field_name'])) }}
                        {% elif fdata['kind'] == "date" %}
                            {{ registration_data['field_data'].get(fdata['field_name'])|date|e }}
                        {% elif fdata['kind'] == "datetime" %}
                            {{ registration_data['field_data'].get(fdata['field_name'])|datetime|e }}
                        {% else %}
                            {{ registration_data['field_data'].get(fdata['field_name'])|e|linebreaks }}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
    {% if not is_locked %}
        <p>
            {{ util.href(cdedblink("event/change_registration_form"), "Ändern") }}
        </p>
    {% endif %}
{% endblock %}
