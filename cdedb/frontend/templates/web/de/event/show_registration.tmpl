{% set sidenav_active='event_registration' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}
Anmeldung von {{ persona['given_names']|e }} {{ persona['family_name']|e }} ({{ ambience['event']['title']|e }})
{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_query"), "Anmeldungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_registration"),
    persona['given_names']|e + " " + persona['family_name']|e, active=True, icon="user") }}
{% endblock %}
{% block content %}
    <table>
        <tr><th colspan="2">Personendaten</th></tr>
        <tr>
            <td>Name</td>
            <td>
                {{ persona['title']|e }}
                {{ persona['given_names']|e }}
                {{ persona['family_name']|e }}
                {{ persona['name_supplement']|e }}
            </td>
        </tr>
        <tr>
            <td>CdEDB-ID</td>
            <td>{{ persona['id']|cdedbid|e }}</td>
        </tr>
        <tr>
            <td>Online CdEDB-ID (für Offline-Registrierungen))</td>
            <td>{{ ambience['registration']['real_persona_id']|cdedbid|e }}</td>
        </tr>
        <tr>
            <td>Mitglied</td>
            <td>{{ util.deko_checkbox(checked=(persona['is_member'])) }}</td>
        </tr>
        <tr>
            <td>Geburtstag/Altersklasse</td>
            <td>
                {{ persona['birthday']|e }} ({{ gettext(age|string)|e }})
            </td>
        </tr>
        <tr>
            <td>Geschlecht</td>
            <td>{{ persona['gender']|gender|e }}</td>
        </tr>
        <tr>
            <td>E-Mail</td>
            <td> {{ persona['username']|e }} </td>
        </tr>
        <tr>
            <td>Telefon</td>
            <td>{{ persona['telephone']|e }}</td>
        </tr>
        <tr>
            <td>Mobiltelefon</td>
            <td>{{ persona['mobile']|e }}</td>
        </tr>
        <tr>
            <td>Straße</td>
            <td>{{ persona['address']|e }}</td>
        </tr>
        <tr>
            <td>Adresszusatz</td>
            <td>{{ persona['address_supplement']|e }}</td>
        </tr>
        <tr>
            <td>Stadt</td>
            <td>{{ persona['postal_code']|e }} {{ persona['location']|e }}</td>
        </tr>
        <tr>
            <td>Land</td>
            <td>{{ persona['country']|e }}</td>
        </tr>
        <tr><th colspan="2">Allgemeine Angaben</th></tr>
        <tr>
            <td>Orga</td>
            <td>
                {{ util.deko_checkbox(checked=(persona['id'] in ambience['event']['orgas'])) }}
            </td>
        </tr>
        <tr>
            <td>Anmerkungen</td>
            <td>{{ ambience['registration']['notes']|rst }}</td>
        </tr>
        <tr>
            <td>Orga-Notizen</td>
            <td>{{ ambience['registration']['orga_notes']|rst }}</td>
        </tr>
        <tr>
            <td>Teilnehmerbeitrag bezahlt am</td>
            <td>{{ ambience['registration']['payment']|date|e }}</td>
        </tr>
        <tr>
            <td>Einverständniserklärung der Eltern</td>
            <td>
                {% if not age.is_minor() %}
                    volljährig
                {% else %}
                    {{ util.deko_checkbox(checked=ambience['registration']['parental_agreement']) }}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>Gemischte Unterbringung</td>
            <td>
                {{ util.deko_checkbox(checked=ambience['registration']['mixed_lodging']) }}
            </td>
        </tr>
        <tr>
            <td>Checkin</td>
            <td>{{ ambience['registration']['checkin']|datetime|e }}</td>
        </tr>
        <tr>
            <td>Foto-Einwilligung</td>
            <td>
                {{ util.deko_checkbox(checked=ambience['registration']['foto_consent']) }}
            </td>
        </tr>
        {% for part_id, part in ambience['event']['parts']|dictsort %}
            <tr><th colspan="2">{{ part['title']|e }}</th></tr>
            <tr>
                <td>Status</td>
                <td>
                    {{ gettext(ambience['registration']['parts'][part_id]['status']
                            |enum(enums['RegistrationPartStati']))|e }}
                </td>
            </tr>
            <tr>
                <td>Kurs</td>
                <td>
                    {% if ambience['registration']['parts'][part_id]['course_id'] %}
                        {{ courses[ambience['registration']['parts'][part_id]['course_id']]['title']|e }}
                    {% endif %}
                </td>
            </tr>
            {% for prio in ("Erstwahl", "Zweitwahl", "Drittwahl",) %}
                <tr>
                    <td>{{ prio|e }}</td>
                    <td>
                        {% if ambience['registration']['choices'].get(part_id, [])|length > loop.index0  %}
                            {{ courses[ambience['registration']['choices'][part_id][loop.index0]]['title']|e }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            <tr>
                <td>Kursleiter</td>
                <td>
                    {% if ambience['registration']['parts'][part_id]['course_instructor'] %}
                        {{ courses[ambience['registration']['parts'][part_id]['course_instructor']]['title']|e }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Unterkunft</td>
                <td>
                    {% if ambience['registration']['parts'][part_id]['lodgement_id'] %}
                        {{ lodgements[ambience['registration']['parts'][part_id]['lodgement_id']]['moniker']|e }}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        <tr><th colspan="2">Felder</th></tr>
        {% for field_id, field in ambience['event']['fields']|dictsort %}
            <tr>
                <td>{{ field['field_name']|e }}</td>
                <td>
                    {% if field['entries'] %}
                        {% for value, description in field['entries'] %}
                            {% if ambience['registration']['fields'].get(field['field_name']) == value %}
                                {{ description|e }}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% if field['kind'] == "bool" %}
                            {{ util.deko_checkbox(
                                checked=ambience['registration']['fields'].get(field['field_name'])) }}
                        {% elif field['kind'] == "date" %}
                            {{ ambience['registration']['fields'].get(field['field_name'])|date|e }}
                        {% elif field['kind'] == "datetime" %}
                            {{ ambience['registration']['fields'].get(field['field_name'])|datetime|e }}
                        {% else %}
                            {{ ambience['registration']['fields'].get(field['field_name'])|e|linebreaks }}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
    {% if not is_locked %}
        <p>
            {{ util.href(cdedblink("event/change_registration_form"), "Ändern") }}
        </p>
    {% endif %}
{% endblock %}
