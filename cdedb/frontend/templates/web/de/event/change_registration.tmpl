{% set sidenav_active='event_registration' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}
Anmeldung von {{ persona_data['given_names']|e }} {{ persona_data['family_name']|e }} bearbeiten
({{ event_data['title']|e }})
{% endblock %}
{% block content %}
    {{ util.href(cdedblink("event/show_registration"), "Abbrechen") }}
    <form action="{{ cdedblink('event/change_registration')|e }}" method="POST" id="changeregistrationform">
        <table>
            <tr><th colspan="2">Allgemeine Angaben</th></tr>
            {{ util.input_text(name="reg.real_persona_id", label="Online CdEDB-ID") }}
            {{ util.input_textarea(name="reg.notes", label="Anmerkungen", aclass="biggg") }}
            {{ util.input_textarea(name="reg.orga_notes", label="Orga-Notizen", aclass="biggg") }}
            {{ util.input_text(name="reg.payment", label="Teilnehmerbeitrag bezahlt am") }}
            {{ util.input_checkbox(name="reg.parental_agreement", label="Einverständniserklärung der Eltern") }}
            {{ util.input_checkbox(name="reg.mixed_lodging", label="Gemischte Unterbringung") }}
            {{ util.input_text(name="reg.checkin", label="Checkin") }}
            {{ util.input_checkbox(name="reg.foto_consent", label="Foto-Einwilligung") }}
            {% for part_id, pdata in event_data['parts']|dictsort %}
                <tr><th colspan="2">{{ pdata['title']|e }}</th></tr>
                {# jinja does not support list comprehension ... #}
                {% set myentries = [] %}
                {% for s in const.RegistrationPartStati %}
                    {{ myentries.append((s.value, i18n(s|string), None))|e }}
                {% endfor %}
                {{ util.input_select(name="part{}.status".format(part_id), label="Status", entries=myentries) }}
                {# jinja does not support list comprehension ... #}
                {% set myentries = [] %}
                {% for course_id in course_choices[part_id] %}
                    {{ myentries.append((course_id, course_data[course_id]['title'], None))|e }}
                {% endfor %}
                {{ util.input_select(name="part{}.course_id".format(part_id), label="Kurs", entries=myentries,
                                         nulloption=True) }}
                {{ util.input_select(name="part{}.course_choice_0".format(part_id), label="Erstwahl",
                                         entries=myentries, nulloption=True) }}
                {{ util.input_select(name="part{}.course_choice_1".format(part_id), label="Zweitwahl",
                                         entries=myentries, nulloption=True) }}
                {{ util.input_select(name="part{}.course_choice_2".format(part_id), label="Drittwahl",
                                         entries=myentries, nulloption=True) }}
                {{ util.input_select(name="part{}.course_instructor".format(part_id), label="Kursleiter",
                                         entries=myentries, nulloption=True) }}
                {# jinja does not support list comprehension ... #}
                {% set myentries = [] %}
                {% for lodgement_id, ldata in lodgement_data|dictsort %}
                    {{ myentries.append((lodgement_id, ldata['moniker'], None))|e }}
                {% endfor %}
                {{ util.input_select(name="part{}.lodgement_id".format(part_id), label="Unterkunft",
                                         entries=myentries, nulloption=True) }}
            {% endfor %}
            <tr><th colspan="2">Felder</th></tr>
            {% for field_id, fdata in event_data['fields']|dictsort %}
               {{ util.tab_event_field_input(fdata) }}
            {% endfor %}
        </table>
        <div>
            {{ util.input_submit(value="Speichern") }}
        </div>
    </form>
{% endblock %}
