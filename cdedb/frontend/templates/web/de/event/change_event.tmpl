{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}{{ data['title']|e }} bearbeiten{% endblock %}
{% block content %}
    <a href="{{ cdedblink("event/show_event")|e }}">Abbrechen</a>
    <form action="{{ cdedblink('event/change_event')|e }}" method="POST" id="changeeventform">
        <table>
            {{ util.tab_input_text(name="title", label="Titel") }}
            {{ util.tab_input_text(name="organizer", label="Organisator") }}
            {{ util.tab_input_textarea(name="description", label="Beschreibung", aclass="biggg") }}
            {{ util.tab_input_text(name="shortname", label="Kürzel") }}
            {{ util.tab_input_text(name="registration_start", label="Anmeldebeginn") }}
            {{ util.tab_input_text(name="registration_soft_limit", label="offizieller Anmeldeschluss") }}
            {{ util.tab_input_text(name="registration_hard_limit", label="tatsächlicher Anmeldeschluss") }}
            {{ util.tab_input_checkbox(name="use_questionnaire") }}
            {{ util.tab_input_textarea(name="notes", label="Notizen", aclass="biggg") }}
        </table>
        <div>
            {{ util.input_submit(value="Speichern", readonly=locked) }}
        </div>
    </form>
    <h2>Minderjährigenformular</h2>
    {% if minor_form_present %}
        <a href="{{ cdedblink('event/get_minor_form')|e }}">aktuelles Formular</a>
    {% else %}
        <strong>Kein Formular vorhanden.</strong>
    {% endif %}
    <form action="{{ cdedblink('event/change_minor_form')|e }}" method="POST" enctype="multipart/form-data" id="changeminorformform">
        <div>
            {{ util.input_file(name="minor_form", accept="application/pdf", info="Eine pdf-Datei.") }}
            {{ util.input_submit(value="Hochladen", readonly=locked) }}
        </div>
    </form>
    <h2>Teile</h2>
    <ul>
        {% for anid, entry in data['parts']|dictsort %}
            <li>
                {{ entry['title']|e }} ({{ entry['part_begin']|date|e }}--{{ entry['part_end']|date|e }}; {{ entry['fee']|e }}€)
                <a href="{{ cdedblink('event/change_part_form', {'part_id': anid})|e }}" {% if locked %} disabled {% endif %}>bearbeiten</a>
            </li>
        {% endfor %}
    </ul>
    <h3>Teil hinzufügen</h3>
    <form action="{{ cdedblink('event/add_part')|e }}" method="POST" id="addpartform">
        <table>
            {{ util.tab_input_text(name="part_title", label="Name") }} {# name is not 'title' because of duplication #}
            {{ util.tab_input_text(name="part_begin", label="Beginn") }}
            {{ util.tab_input_text(name="part_end", label="Ende") }}
            {{ util.tab_input_text(name="fee", label="Teilnehmerbeitrag") }}
        </table>
        <div>
            {{ util.input_submit(value="Teil hinzufügen", readonly=locked) }}
        </div>
    </form>
    <h2>Orgas</h2>
    <ul>
        {% for anid, entry in orgas|dictsort %}
            <li>
                {{ entry['given_names']|e }} {{ entry['family_name']|e }} ({{ anid|cdedbid|e }})
                <form action="{{ cdedblink('event/remove_orga')|e }}" method="POST" id="removeorgaform{{ anid|e }}">
                    <div>
                        {{ util.input_hidden(name="orga_id", value=anid) }}
                        {{ util.input_submit(value="Orga löschen", readonly=locked) }}
                    </div>
                </form>
            </li>
        {% endfor %}
    </ul>
    <h3>Orga hinzufügen</h3>
    <form action="{{ cdedblink('event/add_orga')|e }}" method="POST" id="addorgaform">
        <div>
            {{ util.input_text(name="orga_id", label="ID") }}
            {{ util.input_submit(value="Orga hinzufügen", readonly=locked) }}
        </div>
    </form>
    <h2>Datenfelder</h2>
    <ul>
        {% for anid, entry in data['fields']|dictsort %}
            <li>
                <p>
                    {{ entry['field_name']|e }} ({{ entry['kind']|e }}
                </p>
                {% if entry['entries'] %}
                    <p>
                        Auswahlmöglichkeiten
                        <table>
                            <tr>
                                <th>Möglichkeit</th>
                                <th>Beschreibung</th>
                            </tr>
                            {% for value, description in entry['entries'] %}
                                <tr>
                                    <td>{{ value|e }}</td>
                                    <td>{{ description|e }}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    </p>
                {% endif %}
                <a href="{{ cdedblink('event/change_field_form', {'field_id': anid})|e }}" {% if locked %} disabled {% endif %}>bearbeiten</a>
                <form action="{{ cdedblink('event/remove_field')|e }}" method="POST" id="removefieldform{{ anid|e }}">
                    <div>
                        {{ util.input_hidden(name="field_id", value=anid) }}
                        {{ util.input_submit(value="Feld löschen", readonly=locked) }}
                    </div>
                </form>
            </li>
        {% endfor %}
    </ul>
    <h3>Feld hinzufügen</h3>
    <form action="{{ cdedblink('event/add_field')|e }}" method="POST" id="addfieldform">
        <table>
            {{ util.tab_input_text(name="field_name", label="Name") }}
            {{ util.tab_input_select(name="kind", title="Typ", entries=(
                ("str", "String", None), ("bool", "Ja/Nein", None), ("int", "Zahl", None), ("date", "Datum", None), ("datetime", "Datum mit Uhrzeit", None))) }}
            {{ util.tab_input_textarea(name="entries", label="Auswahlmöglichkeiten", info="Format ist 'Wert;langer Beschreibungstext' pro Zeile.") }}
        </table>
        <div>
            {{ util.input_submit(value="Feld hinzufügen", readonly=locked) }}
        </div>
    </form>
    <h2>Offline Nutzung</h2>
    {% if not data['offline_lock'] and not locked %}
        <form action="{{ cdedblink('event/change_event')|e }}" method="POST" id="lockeventform">
            <div>
                {{ util.input_hidden(name="offline_lock", value=True) }}
                {{ util.input_submit(value="Veranstaltung für offline Nutzung sperren") }}
            </div>
        </form>
    {% else %}
        TODO
    {% endif %}
{% endblock %}
