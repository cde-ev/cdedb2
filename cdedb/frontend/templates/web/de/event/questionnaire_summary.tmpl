{% set sidenav_active='event_config' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block scripts %}{{ util.jquery_with_ui_preamble() }}{% endblock %}
{% block javascripthint %}{{ util.javascript_hint() }}{% endblock %}
{% block title %}{{ ambience['event']['title']|e }} Fragebogenkonfiguration{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/questionnaire_summary"), "Fragebogen konfigurieren", active=True) }}
{% endblock %}
{% block content %}
    {# jinja does not support list comprehension ... #}
    {% set field_entries = [("", "nur Text")] %}
    {% for field_id, field in ambience['event']['fields']|dictsort %}
        {{ field_entries.append((field_id, field['field_name']))|e }}
    {% endfor %}
    <form action="{{ cdedblink('event/questionnaire_summary')|e }}" method="POST" id="questionnairesummaryform">
        {% with INPUT_SIZE_LABELS = {0: "einzeilig",
                                     2: "mehrzeilig",
                                     3: "mehrzeilig+",
                                     4: "mehrzeilig++",}%}
            <ul>
                {% for entry in questionnaire %}
                    <li>
                        <table>
                            {{ util.form_input_checkbox("delete_{}".format(loop.index0), label="Löschen") }}
                            {{ util.form_input_select("field_id_{}".format(loop.index0), label="Abfrage",
                                                     entries=field_entries) }}
                            {{ util.form_input_text(name="title_{}".format(loop.index0), label="Label/Überschrift") }}
                            {{ util.form_input_textarea(name="info_{}".format(loop.index0), label="Text") }}
                            {{ util.form_input_select(
                                "input_size_{}".format(loop.index0), label="Eingabefeldgröße", entries=(
                                    (0, INPUT_SIZE_LABELS[0]), (2, INPUT_SIZE_LABELS[2]),
                                    (3, INPUT_SIZE_LABELS[3]), (4, INPUT_SIZE_LABELS[4]))) }}
                            {{ util.form_input_checkbox("readonly_{}".format(loop.index0), label="Schreibgeschützt") }}
                        </table>
                    </li>
                {% endfor %}
                <li>
                    {{ util.form_input_checkbox("create_-1", label="Hinzufügen") }}
                    {{ util.form_input_select("field_id_-1", label="Abfrage", entries=field_entries) }}
                    {{ util.form_input_text(name="title_-1", label="Label/Überschrift") }}
                    {{ util.form_input_textarea(name="info_-1", label="Text") }}
                    {{ util.form_input_select("input_size_-1", label="Eingabefeldgröße",
                                              entries=((0, INPUT_SIZE_LABELS[0]), (2, INPUT_SIZE_LABELS[2]),
                                                       (3, INPUT_SIZE_LABELS[3]), (4, INPUT_SIZE_LABELS[4]))) }}
                    {{ util.form_input_checkbox("readonly_-1", label="Schreibgeschützt") }}
                </li>
            </ul>
            <div>
                {{ util.form_input_submit(value="Ändern", readonly=is_locked) }}
            </div>
        {% endwith %}
    </form>
    {{ util.href(cdedblink('event/reorder_questionnaire_form'), "umordnen", readonly=is_locked) }}
{% endblock %}
