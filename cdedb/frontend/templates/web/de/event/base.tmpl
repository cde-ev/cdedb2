{% extends "web/de/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}

{% macro one_event_links(event_id, event_entry) %}
{# Uninlined code to generate links for the current relevant event. #}
    <ul>
        {% if not event_entry['registration_id'] %}
            <li>
                {{ util.href(cdedblink("event/register_form", {"event_id": event_id}), "Anmelden",
                             disabled=event_entry['locked']) }}
            </li>
        {% else %}
            <li>
                {{ util.href(cdedblink("event/registration_status", {"event_id": event_id}), "Meine Anmeldung") }}
            </li>
            {% if event_entry['use_questionnaire'] %}
                <li>{{ util.href(cdedblink("event/questionnaire_form", {"event_id": event_id}), "Fragebogen") }}</li>
            {% endif %}
        {% endif %}
        {% if event_id in user.orga or is_admin %}
            <li>{{ util.href(cdedblink("event/summary", {"event_id": event_id}), "Ãœbersicht") }}</li>
            <li>{{ util.href(cdedblink("event/event_config", {"event_id": event_id}), "Konfiguration") }}</li>
            <li>{{ util.href(cdedblink("event/view_event_log", {"event_id": event_id}), "Log") }}</li>
            <li>{{ util.href(cdedblink("event/registration_query", {"event_id": event_id}), "Anmeldungen") }}</li>
            <li>
                {{ util.href(cdedblink("event/add_registration_form", {"event_id": event_id}), "Neuer Teilnehmer",
                             disabled=event_entry['locked']) }}
            </li>
            <li>{{ util.href(cdedblink("event/lodgements", {"event_id": event_id}), "Unterkunft") }}</li>
            <li>
                {{ util.href(cdedblink("event/field_set_select", {"event_id": event_id}), "Datenfeld setzen",
                             disabled=event_entry['locked']) }}
            </li>
            <li>{{ util.href(cdedblink("event/course_choices", {"event_id": event_id}), "Kurswahlen") }}</li>
            <li>{{ util.href(cdedblink("event/downloads", {"event_id": event_id}), "Downloads") }}</li>
            <li>
                {{ util.href(cdedblink("event/checkin_form", {"event_id": event_id}), "Checkin",
                             disabled=event_entry['locked']) }}
            </li>
        {% endif %}
    </ul>
{% endmacro %}

{% macro event_navigation(unfold=False) %}
    <ul>
        <li>
            {{ util.href(cdedblink("core/index"), "Start") }}
            <ul>
                <li>{{ util.href(cdedblink("core/mydata"), "Meine Daten") }}</li>
                <li>{{ util.href(cdedblink("core/change_password_form"), "Passwort Ã¤ndern") }}</li>
            </ul>
        </li>
        {% if "formermember" in user.roles %}
            <li>{{ util.href(cdedblink("cde/index"), "CdE") }}</li>
        {% endif %}
        {% if "event_user" in user.roles %}
            <li>
                {{ util.href(cdedblink("event/index"), "Veranstaltungen") }}
                <ul>
                    {% if is_admin %}
                        <li>{{ util.href(cdedblink("event/create_user_form"), "Neuen Nutzer anlegen") }}</li>
                        <li>{{ util.href(cdedblink("event/user_search_form"), "Nutzersuche") }}</li>
                        <li>{{ util.href(cdedblink("event/view_log"), "Log") }}</li>
                        <li>{{ util.href(cdedblink("event/list_events"), "alle DB-Veranstaltungen") }}</li>
                        <li>{{ util.href(cdedblink("event/create_event_form"), "DB-Veranstaltung anlegen") }}</li>
                    {% endif %}
                    <li>
                        aktuelle Veranstaltungen
                        <ul>
                            {% for anid, entry in sidebar_events|dictsort|reverse %}
                                <li>
                                    {{ util.href(cdedblink("event/show_event", {"event_id": anid}), entry['title']) }}
                                    {% if unfold and anid == values.get('event_id') %}
                                        {{ one_event_links(anid, entry) }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% if is_admin %}
                        <li>
                            abgeschlossene Veranstaltungen
                            <ul>
                                <li>
                                    {{ util.href(cdedblink("event/list_past_events"), "alle abg. Veranstaltungen") }}
                                </li>
                                <li>
                                    {{ util.href(cdedblink("event/create_past_event_form"),
                                                 "abg. Veranstaltung anlegen") }}
                                </li>
                                <li>{{ util.href(cdedblink("event/view_past_log"), "Log") }}</li>
                            </ul>
                        </li>
                    {% endif %}
                </ul>
            </li>
        {% endif %}
        {% if "ml_user" in user.roles %}
            <li>{{ util.href(cdedblink("ml/index"), "Mailinglisten") }}</li>
        {% endif %}
        {% if "assembly_user" in user.roles %}
            <li>Versammlung</li>
        {% endif %}
    </ul>
{% endmacro %}

{% block navigation %}{{ event_navigation() }}{% endblock %}
