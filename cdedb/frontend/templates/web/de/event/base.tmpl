{% extends "web/de/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}

{% macro one_event_links(event_id, event_entry) %}
{# Uninlined code to generate links for the current relevant event. #}
    <ul>
        {% if not event_entry['registration_id'] %}
            <li>
                <a href="{{ cdedblink("event/register_form", {"event_id": event_id})|e }}"
                 {% if event_entry['locked'] %} disabled {% endif %}>
                    Anmelden
                </a>
            </li>
        {% else %}
            <li>
                <a href="{{ cdedblink("event/registration_status", {"event_id": event_id})|e }}"> Meine Anmeldung </a>
            </li>
            {% if event_entry['use_questionnaire'] %}
                <li><a href="{{ cdedblink("event/questionnaire_form", {"event_id": event_id})|e }}"> Fragebogen </a></li>
            {% endif %}
        {% endif %}
        {% if event_id in user.orga or is_admin %}
            <li><a href="{{ cdedblink("event/summary", {"event_id": event_id})|e }}">Übersicht</a></li>
            <li><a href="{{ cdedblink("event/event_config", {"event_id": event_id})|e }}">Konfiguration</a></li>
            <li><a href="{{ cdedblink("event/view_event_log", {"event_id": event_id})|e }}">Log</a></li>
            <li><a href="{{ cdedblink("event/registration_query", {"event_id": event_id})|e }}">Anmeldungen</a></li>
            <li>
                <a href="{{ cdedblink("event/add_registration_form", {"event_id": event_id})|e }}"
                 {% if event_entry['locked'] %} disabled {% endif %}>
                    Neuer Teilnehmer
                </a>
            </li>
            <li><a href="{{ cdedblink("event/lodgements", {"event_id": event_id})|e }}">Unterkunft</a></li>
            <li>
                <a href="{{ cdedblink("event/field_set_select", {"event_id": event_id})|e }}"
                 {% if event_entry['locked'] %} disabled {% endif %}>
                    Datenfeld setzen
                </a>
            </li>
            <li><a href="{{ cdedblink("event/course_choices", {"event_id": event_id})|e }}">Kurswahlen</a></li>
            <li><a href="{{ cdedblink("event/downloads", {"event_id": event_id})|e }}">Downloads</a></li>
            <li>
                <a href="{{ cdedblink("event/checkin_form", {"event_id": event_id})|e }}"
                 {% if event_entry['locked'] %} disabled {% endif %}>
                    Checkin
                </a>
            </li>
        {% endif %}
    </ul>
{% endmacro %}

{% macro event_navigation(unfold=False) %}
    <ul>
        <li>
            <a href="{{ cdedblink("core/index")|e }}">Start</a>
            <ul>
                <li><a href="{{ cdedblink("core/mydata")|e }}">Meine Daten</a></li>
                <li><a href="{{ cdedblink("core/change_password_form")|e }}">Passwort ändern</a></li>
            </ul>
        </li>
        {% if "formermember" in user.roles %}
            <li><a href="{{ cdedblink("cde/index")|e }}">CdE</a></li>
        {% endif %}
        {% if "event_user" in user.roles %}
            <li>
                <a href="{{ cdedblink("event/index")|e }}">Veranstaltungen</a>
                <ul>
                    {% if is_admin %}
                        <li><a href="{{ cdedblink("event/create_user_form")|e }}">Neuen Nutzer anlegen</a></li>
                        <li><a href="{{ cdedblink("event/user_search_form")|e }}">Nutzersuche</a></li>
                        <li><a href="{{ cdedblink("event/view_log")|e }}">Log</a></li>
                        <li><a href="{{ cdedblink("event/list_events")|e }}">alle DB-Veranstaltungen</a></li>
                        <li><a href="{{ cdedblink("event/create_event_form")|e }}">DB-Veranstaltung anlegen</a></li>
                    {% endif %}
                    <li>
                        aktuelle Veranstaltungen
                        <ul>
                            {% for anid, entry in sidebar_events|dictsort|reverse %}
                                <li>
                                    <a href="{{ cdedblink("event/show_event", {"event_id": anid})|e }}">
                                        {{ entry['title']|e }}
                                    </a>
                                    {% if unfold and anid == values.get('event_id') %}
                                        {{ one_event_links(anid, entry) }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% if is_admin %}
                        <li>
                            abgeschlossene Veranstaltungen
                            <ul>
                                <li>
                                    <a href="{{ cdedblink("event/list_past_events")|e }}">
                                        alle abg. Veranstaltungen
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ cdedblink("event/create_past_event_form")|e }}">
                                        abg. Veranstaltung anlegen
                                    </a>
                                </li>
                                <li><a href="{{ cdedblink("event/view_past_log")|e }}">Log</a></li>
                            </ul>
                        </li>
                    {% endif %}
                </ul>
            </li>
        {% endif %}
        {% if "ml_user" in user.roles %}
            <li><a href="{{ cdedblink("ml/index")|e }}">Mailinglisten</a></li>
        {% endif %}
        {% if "assembly_user" in user.roles %}
            <li>Versammlung</li>
        {% endif %}
    </ul>
{% endmacro %}

{% block navigation %}{{ event_navigation() }}{% endblock %}
