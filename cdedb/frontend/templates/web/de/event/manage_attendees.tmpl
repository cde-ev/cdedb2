{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block scripts %}{{ util.jquery_with_ui_preamble() }}{% endblock %}
{% set jshint='weak' %}
{% block title %}
Kursteilnehmer f√ºr Kurs {{ ambience['course']['title']|e }} verwalten ({{ ambience['event']['title']|e }})
{% endblock %}
{% block content %}
    {% for track_id in ambience['course']['active_segments']|sort %}
        <h2>{{ ambience['event']['tracks'][track_id]['title']|e }}</h2>
        <div>
            Kursteilnehmer
            <ul id="attendees_{{ track_id|e }}" class="connect_{{ track_id|e }} nonVanish">
                {% for registration_id in attendees[(ambience['course']['id'], track_id)] %}
                    <li class="selectee_{{ track_id|e }}" id="{{ registration_id|e }}_{{ track_id|e }}"
                     regid="{{ registration_id|e }}">
                        {{ personas[registrations[registration_id]['persona_id']]['given_names']|e }}
                        {{ personas[registrations[registration_id]['persona_id']]['family_name']|e }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div>
            Personen ohne Kurs
            (Namen suchen
             <input type="text" name="selector_without_{{ track_id|e }}" id="selector_without_{{ track_id|e }}"
              class="jsEnabled" value="" disabled>)
            <ul id="without_{{ track_id|e }}" class="scrollList connect_{{ track_id|e }} nonVanish">
                {% for registration_id in without_course[track_id] %}
                    <li class="selectee_{{ track_id|e }}" id="{{ registration_id|e }}_{{ track_id|e }}"
                     regid="{{ registration_id|e }}">
                        {{ personas[registrations[registration_id]['persona_id']]['given_names']|e }}
                        {{ personas[registrations[registration_id]['persona_id']]['family_name']|e }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div>
            Personen mit Kurs
            (Namen suchen
             <input type="text" name="selector_with_{{ track_id|e }}" id="selector_with_{{ track_id|e }}"
              class="jsEnabled" value="" disabled>)
            <ul id="with_{{ track_id|e }}"  class="shortScrollList connect_{{ track_id|e }} nonVanish">
                {% for registration_id in with_course[track_id] %}
                    <li class="selectee_{{ track_id|e }}" id="{{ registration_id|e }}_{{ track_id|e }}"
                     regid="{{ registration_id|e }}">
                        {{ personas[registrations[registration_id]['persona_id']]['given_names']|e }}
                        {{ personas[registrations[registration_id]['persona_id']]['family_name']|e }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <script type="text/javascript">
            $(document).ready(function(){
                $("#attendees_{{ track_id|e }}, #with_{{ track_id|e }}, #without_{{ track_id|e }}").sortable(
                    {connectWith: ".connect_{{ track_id|e }}"}).disableSelection();
                $("#selector_without_{{ track_id|e }}").keyup(function(){
                    $("#without_{{ track_id|e }} .selectee_{{ track_id|e }}").hide();
                    $("#without_{{ track_id|e }} .selectee_{{ track_id|e }}:contains('" + $(this).val() + "')").show();
                });
                $("#selector_with_{{ track_id|e }}").keyup(function(){
                    $("#with_{{ track_id|e }} .selectee_{{ track_id|e }}").hide();
                    $("#with_{{ track_id|e }} .selectee_{{ track_id|e }}:contains('" + $(this).val() + "')").show();
                });
            });
        </script>
    {% endfor %}
    <form action="{{ cdedblink('event/manage_attendees')|e }}" method="POST" id="manageattendeesform">
        {% for track_id in ambience['course']['active_segments']|sort %}
            {{ util.input_hidden(name="attendees_{}".format(track_id), value="",
                                 anid="attendeesinput_{}".format(track_id)) }}
        {% endfor %}
        {{ util.form_input_submit(value="Speichern", readonly=True, aclass="jsEnabled") }}
    </form>
    <script type="text/javascript">
        $(document).ready(function(){
            $("#manageattendeesform").submit(function(){
                {% for track_id in ambience['course']['active_segments']|sort %}
                    var sorted = $("#attendees_{{ track_id|e }}").sortable("toArray", { attribute: "regid" })
                    $("#attendeesinput_{{ track_id|e }}").val(sorted.join(","))
                {% endfor %}
            });
        });
    </script>
{% endblock %}
