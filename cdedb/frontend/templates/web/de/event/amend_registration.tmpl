{% set sidenav_active='event_register' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}Anmeldung zur Veranstaltung {{ event_data['title']|e }} aktualisieren{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_begin() }}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/register"), "Anmeldung") }}
{{ util.breadcrumb_link(cdedblink("event/amend_registration"), "Ändern", active=True) }}
{{ util.breadcrumb_end() }}
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('event/amend_registration')|e }}" method="POST" id="amendregistrationform">
        <table>
            {% if not age.may_mix() %}
                <tr>
                    <td>Gemischte Unterbringung</td>
                    <td>
                        Keine gemischte Unterbringung.
                        {{ util.input_hidden(name="mixed_lodging", value=False) }}
                    </td>
                </tr>
            {% else %}
                {% if age.is_minor() %}
                    {% set mix_info = glue("Die Auswahl muss mit der Einverständniserklärung der",
                                           "Erziehungsberechtigten kompatibel sein.") %}
                {% else %}
                    {% set mix_info = "" %}
                {% endif %}
                {{ util.form_input_select(name="mixed_lodging", entries=(
                    (True, "Ich bin mit einer gemischten Unterbringung einverstanden."),
                    (False, "Ich will geschlechter-getrennt untergebracht werden.")),
                    label="Gemischte Unterbringung", info=mix_info, readonly=readonly) }}
            {% endif %}
            {{ util.form_input_checkbox(name="foto_consent", readonly=readonly, label=glue(
                    "Ich bin damit einverstanden, dass Fotos und Aufnahmen meiner Person, die im Rahmen dieser",
                    "Veranstaltung entstehen, für die Veranstaltungsdokumentation und eine CdE-interne,",
                    "passwortgeschützte Fotogalerie verwendet werden. Einzelne Fotos können auf gesonderten",
                    "Wunsch davon ausgenommen werden.")) }}
            {{ util.form_input_textarea(name="notes", label="Anmerkungen", rows="5", readonly=readonly) }}
            {% for part_id, course_list in course_choices|dictsort %}
                {% if (course_list and part_id in parts
                       and const.RegistrationPartStati(parts[part_id]['status']).is_involved()) %}
                    <tr><th colspan="2">Kurswahl {{ event_data['parts'][part_id]['title']|e }}</th></tr>
                    {# jinja does not support list comprehension ... #}
                    {% set myentries = [] %}
                    {% for course_id in course_list %}
                        {{ myentries.append((course_id, course_data[course_id]['title']))|e }}
                    {% endfor %}
                    {{ util.form_input_select(name="course_choice{}_0".format(part_id), entries=myentries,
                                             label="Erstwahl", readonly=readonly) }}
                    {{ util.form_input_select(name="course_choice{}_1".format(part_id), entries=myentries,
                                             label="Zweitwahl", readonly=readonly) }}
                    {{ util.form_input_select(name="course_choice{}_2".format(part_id), entries=myentries,
                                             label="Drittwahl", readonly=readonly) }}
                    {# jinja does not support list comprehension ... #}
                    {% set myentries = [("", "Ich bin kein Kursleiter.")] %}
                    {% for course_id in course_list %}
                        {{ myentries.append((course_id, course_data[course_id]['title']))|e }}
                    {% endfor %}
                    {{ util.form_input_select(name="course_instructor{}".format(part_id), entries=myentries,
                                             label="Kursleiter", readonly=readonly) }}
                {% endif %}
            {% endfor %}
        </table>
        <div>
            {% if not readonly %}
                {{ util.form_input_submit(value="Daten aktualisieren") }}
            {% endif %}
        </div>
    </form>
{% endblock %}
