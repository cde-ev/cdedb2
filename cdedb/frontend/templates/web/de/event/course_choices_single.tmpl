{% set sidenav_active='event_course_choices' %}
{% extends "web/de/event/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}
Kurswahlen -- {{ course_data[values['course_id']|int]['title']|e }} ({{ event_data['title']|e }})
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('event/course_choices')|e }}" method="GET" id="choiceform">
        {# jinja does not support list comprehension ... #}
        {% set myentries = [("", "Gesamt√ºbersicht", None)] %}
        {% for course_id, cdata in course_data|dictsort %}
            {{ myentries.append((course_id, cdata['title'], None))|e }}
        {% endfor %}
        {{ util.input_select(name="course_id", label="Auswahl", entries=myentries) }}
        {{ util.input_submit(value="Aktualisieren") }}
    </form>
    {% for part_id, pdata in event_data['parts']|dictsort %}
        <h2>{{ pdata['title']|e }}</h2>
        <table>
            <tr>
                <th>Teilnehmer</th>
                <th>Erstwahl</th>
                <th>Zweitwahl</th>
                <th>Drittwahl</th>
            </tr>
            {% for i in range(3) %}
                {% for registration_id in candidates[(part_id, i)] %}
                    <tr>
                        <td>
                            {% with pd = persona_data[registration_data[registration_id]['persona_id']] %}
                                {{ util.href(cdedblink("event/show_registration", {'registration_id': registration_id}),
                                             "{} {}".format(pd['given_names'], pd['family_name'])) }}
                            {% endwith %}
                         </td>
                         {% for j in range(3) %}
                             <td>
                                 {% if registration_data[registration_id]['choices'][part_id]|length > j %}
                                    {% if i == j %}
                                        <strong>
                                    {% endif %}
                                    {{ course_data[registration_data[registration_id]['choices'][part_id][j]][
                                        'shortname']|e }}
                                    {% if i == j %}
                                        </strong>
                                    {% endif %}
                                 {% endif %}
                             </td>
                         {% endfor %}
                     </tr>
                {% endfor %}
            {% endfor %}
        </table>
    {% endfor %}
{% endblock %}
