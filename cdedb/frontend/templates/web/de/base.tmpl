{# This is the base template to be extended by (nearly) all html templates.
   It provides a skeleton where only the content needs to be filled in. #}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
        <title>{% block title %}CdEDB{% endblock %}</title>
        <link rel="stylesheet" type="text/css" href="/static/cdedb.css" media="all">
        <link rel="stylesheet" type="text/css" href="/static/print.css" media="print">
        {% block colorscheme %}
        <!-- TODO colorscheme: user - blue; orga or ml-moderator - green; realm admin - yellow; global admin - red -->
        {% endblock %}
        {% block jquery %} <!-- insert jquery here --> {% endblock %}
    </head>
    <body>
        <div id="header">
            {% block header %}More logo{% endblock %}
        </div>
        <div id="middle">
            <div id="strut"></div>
            <div id="navigation">
                <h1>{{ util.href(cdedblink("core/index"), "CdEDB") }}</h1>
                {% if not user.is_persona %}
                    <p>
                        Nicht eingeloggt<br>
                        {{ util.href(cdedblink("core/index"), "Login") }}
                    </p>
                {% else %}
                    <form action="{{ cdedblink("core/logout")|e }}" method="POST" id="logoutform">
                        <p>
                            Eingeloggt als:<br>
                            <span id="displayname">{{ user.display_name|e }}</span>
                            <input type="submit" name="submitlogout" value="Abmelden">
                        </p>
                    </form>
                {% endif %}
                <hr>
                <h2>Navigation</h2>
                    {% block navigation %}
                        <ul>
                            {% if user.persona_id %}
                                <li>
                                    {{ util.href(cdedblink("core/index"), "Start") }}
                                    <ul>
                                        <li>{{ util.href(cdedblink("core/mydata"), "Meine Daten") }}</li>
                                        <li>
                                            {{ util.href(cdedblink("core/change_password_form"), "Passwort ändern") }}
                                        </li>
                                    </ul>
                                    {% block core_navigation %}
                                        <!-- nothing here -->
                                    {% endblock %}
                                </li>
                                {% if "formermember" in user.roles %}
                                    <li>
                                        {{ util.href(cdedblink("cde/index"), "CdE") }}
                                        <ul>
                                            {% if user.is_searchable %}
                                                <li>
                                                    {{ util.href(cdedblink("cde/member_search"), "Mitgliedersuche") }}
                                                </li>
                                            {% else %}
                                                <li>
                                                    {{ util.href(cdedblink("cde/consent_decision_form"),
                                                                 "Datenschutzerklärung") }}
                                                </li>
                                            {% endif %}
                                            <li>
                                                {{ util.href(cdedblink("cde/lastschrift_subscription_form"), "Initiative 25+ beitreten") }}
                                            </li>
                                        </ul>
                                        {% block cde_navigation %}
                                            <!-- nothing here -->
                                        {% endblock %}
                                    </li>
                                {% endif %}
                                {% if "event_user" in user.roles %}
                                    <li>
                                        {{ util.href(cdedblink("event/index"), "Veranstaltungen") }}
                                        {% block event_navigation %}
                                            <!-- nothing here -->
                                        {% endblock %}
                                    </li>
                                {% endif %}
                                {% if "ml_user" in user.roles %}
                                    <li>
                                        {{ util.href(cdedblink("ml/index"), "Mailinglisten") }}
                                        {% block ml_navigation %}
                                            <!-- nothing here -->
                                        {% endblock %}
                                    </li>
                                {% endif %}
                                {% if "assembly_user" in user.roles %}
                                    <li>
                                        {{ util.href(cdedblink("assembly/index"), "Versammlung") }}
                                        {% block assembly_navigation %}
                                            <!-- nothing here -->
                                        {% endblock %}
                                    </li>
                                {% endif %}
                            {% else %}
                                <li>
                                    {{ util.href(cdedblink("core/index"), "Start") }}
                                    <ul>
                                        <li>
                                            {{ util.href(cdedblink("core/genesis_request_form"), "Account anfordern") }}
                                        </li>
                                    </ul>
                                </li>
                            {% endif %}
                        </ul>
                    {% endblock %}
            </div>
            <div id="content">
                {% for ntype, message in notifications %}
                    <div class="notification {{ ntype|e }}Notification">
                        <img src="{{ staticurl("icons/{}.png".format(ntype))|e }}"
                          alt="{{ ntype|e }}" class="notificationIcon">
                        <span class="notificationMessage">{{ i18n(message)|e }}</span>
                    </div>
                {% endfor %}
                {% block javascripthint %}{% endblock %}
                <h1>{{ self.title() }}</h1>
                {% block content %}
                    This should not be visible.
                {% endblock %}
            </div>
            <div id="confirmation_dialogue"><!-- for later user --></div>
        </div>
        <div id="footer">
            {% block footer %}{{ debugstring|e }} ; time taken: {{ generation_time()|e }}{% endblock %}
        </div>
        <!-- common script snippets -->
        <script type="text/javascript">
            if (typeof cdedb_javascript !== 'undefined') {
                $(document).ready(function(){
                    $(".jsEnabled").prop('disabled', false);
                    $(".jsDeleted").remove();
                    $(".jsConfirmed").submit(function(e){
                        e.preventDefault()
                        var form = this;
                        $("#confirmation_dialogue").html("Sind Sie sich sicher?")
                        $("#confirmation_dialogue").dialog({
                            modal: true,
                            title: "Bestätigen",
                            buttons: {
                                "Ja": function() {
                                    $(this).dialog("close");
                                    form.submit();
                                },
                                "Nein": function() {
                                    $(this).dialog("close");
                                }
                            }
                        });
                    });

                });
            };
        </script>
    </body>
    {% if errors %}
        <!-- error listing for debugging
             {{ errors|e }}
        -->
    {% endif %}
</html>
