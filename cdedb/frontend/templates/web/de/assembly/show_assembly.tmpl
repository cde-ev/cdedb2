{% set sidenav_active='assembly_show' %}
{% extends "web/de/assembly/base.tmpl" %}
{% block title %}{{ ambience['assembly']['title']|e }}{% endblock %}
{% block breadcrumb %}
    {{ util.breadcrumb_link(cdedblink("assembly/index"), "Versammlungen") }}
    {{ util.breadcrumb_link(cdedblink("assembly/show_assembly"), ambience['assembly']['title'], icon="bullhorn",
            active=True) }}
{% endblock %}
{% block content %}
    <div class="p">
        {% if is_admin and ambience['assembly']['is_active'] %}
            <form action="{{ cdedblink('assembly/conclude_assembly')|e }}" method="POST" id="concludeassemblyform"
                    style="display: inline;">
                {{ util.input_submit(value="Archivieren", readonly=has_activity, aclass="btn btn-sm btn-danger",
                        icon="ban-circle") }}
            </form>
            {{ util.href(cdedblink("assembly/view_log", {'assembly_id': ambience['assembly']['id']}), "Log",
                    icon="list-alt") }}
        {% endif %}
    </div>

    <dl class="dl-horizontal">
        <dt>Anmeldeschluss</dt>
        <dd>{{ ambience['assembly']['signup_end']|datetime|e }}</dd>
        <dt>Partizipationsstatus</dt>
        <dd>
            {% if attends %}
                <strong class="text-success">Du nimmst an der Versammlung teil.</strong>
            {% else %}
                <p><strong class="text-muted">Du nimmst nicht teil.</strong></p>
                {% if "member" in user.roles and now() < ambience['assembly']['signup_end'] %}
                    <form action="{{ cdedblink('assembly/signup')|e }}" method="POST" id="signupform">
                        {{ util.input_submit(value="Teilnehmen", icon="log-in") }}
                    </form>
                {% endif %}
            {% endif %}
        </dd>
    </dl>

    {{ ambience['assembly']['description']|rst }}

    {% if is_admin and ambience['assembly']['notes'] %}
        <h3>Admin-Notizen</h3>
        {{ ambience['assembly']['notes']|rst }}
    {% endif %}

    {% call util.bootstrap_panel(title="Dateien", icon='file') %}
            {% if attachments %}
                <ul>
                    {% for attachment_id, attachment in attachments|dictsort %}
                        <li>
                            {{ util.href(cdedblink("assembly/get_attachment", {'attachment_id': attachment_id}),
                                    attachment['title'])}}
                            {% if is_admin %}
                                <form action="{{ cdedblink('assembly/remove_attachment',
                                                           {'attachment_id': attachment_id})|e }}"
                                        method="POST" id="removeattachmentform{{ attachment_id|e }}",
                                        style="display: inline;">
                                    {{ util.input_submit(value="", aclass="btn btn-xs btn-danger", icon="trash",
                                            title="Datei löschen") }}
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if is_admin %}
                {{ util.href(cdedblink("assembly/add_attachment_form"), "Datei anhängen",
                             aclass="btn btn-success btn-sm", icon="plus") }}
            {% endif %}
    {% endcall %}
{% endblock %}
