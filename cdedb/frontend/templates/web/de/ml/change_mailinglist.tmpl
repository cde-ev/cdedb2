{% set sidenav_active='ml_change' %}
{% extends "web/de/ml/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block scripts %}{{ util.cdedb_script('helper') }}{% endblock %}
{% block title %}{{ ambience['mailinglist']['title']|e }} – Konfiguration{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("ml/index"), "Mailinglisten") }}
{{ util.breadcrumb_link(cdedblink("ml/show_mailinglist"), ambience['mailinglist']['title'], icon="envelope") }}
{{ util.breadcrumb_link(cdedblink("ml/change_mailinglist"), "Konfiguration", active=True) }}
{% endblock %}
{% block heading %}
    <h1 class="title">
        Konfiguration
        <small>{{ util.make_icon('envelope') }} {{ ambience['mailinglist']['title']|e }}</small>
    </h1>
{% endblock %}
{% block content %}
    <script type="text/javascript">
        $(function() {
            $('#changelistform').cdedbProtectChanges();
        });
    </script>
    <form action="{{ cdedblink('ml/change_mailinglist')|e }}" method="POST" id="changelistform" class="form-horizontal">
        <h4 class="heading-underline">Meta</h4>
        {{ util.form_input_checkbox(name="is_active", label="Aktiv") }}
        {{ util.form_input_text(name="title", label="Titel") }}
        {{ util.form_input_text(name="address", label="Adresse") }}
        {{ util.form_input_textarea(name="description", label="Beschreibung", rows="5",
                info="Öffentlich für den gesamten Empfängerkreis sichtbar.") }}
        {{ util.form_input_textarea(name="notes", label="Notizen", rows="5") }}

        <h4 class="heading-underline">Moderation &amp; Empfänger</h4>
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for policy in enums['ModerationPolicy'] %}
        {{ myentries.append((policy.value, i18n(policy|string)))|e }}
        {% endfor %}
        {{ util.form_input_select(name="mod_policy", label="Moderation", entries=myentries) }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for policy in enums['AudiencePolicy'] %}
            {{ myentries.append((policy.value, i18n(policy|string)))|e }}
        {% endfor %}
        {{ util.form_input_select(name="audience_policy", label="Empfängerkreis", entries=myentries) }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for policy in enums['SubscriptionPolicy'] %}
            {{ myentries.append((policy.value, i18n(policy|string)))|e }}
        {% endfor %}
        {{ util.form_input_select(name="sub_policy", label="Einschreibung", entries=myentries) }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for event_id, title in events|dictsort %}
        {{ myentries.append((event_id, title))|e }}
        {% endfor %}
        {{ util.form_input_select(name="event_id", label="Veranstaltung", nulloption=True, entries=myentries) }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for status in enums['RegistrationPartStati'] %}
        {{ myentries.append((status.value, i18n(status|string)))|e }}
        {% endfor %}
        {{ util.form_input_checkboxes(name="registration_stati", label="Veranstaltungsempfänger",
                    entries=myentries, info="Keine Auswahl entspricht einer Orgaliste.") }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for assembly_id, assembly in assemblies|dictsort %}
        {{ myentries.append((assembly_id, assembly['title']))|e }}
        {% endfor %}
        {{ util.form_input_select(name="assembly_id", label="Versammlung", nulloption=True, entries=myentries) }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for mailinglist_id, title in mailinglists|dictsort %}
            {{ myentries.append((mailinglist_id, title))|e }}
        {% endfor %}
        {{ util.form_input_select(name="gateway", label="Zugangsvererbung", nulloption=True, entries=myentries,
                                 info="Mitglieder der gewählten Liste können sich in diese Liste einschreiben.") }}

        <h4 class="heading-underline">Mails</h4>
        {{ util.form_input_text(name="subject_prefix", label="Präfix (Betreffzeile)") }}
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for policy in enums['AttachmentPolicy'] %}
            {{ myentries.append((policy.value, i18n(policy|string)))|e }}
        {% endfor %}
        {{ util.form_input_select(name="attachment_policy", label="Anhänge", entries=myentries) }}
        {{ util.form_input_text(name="maxsize", label="max. Nachrichtengröße (in kB)") }}
        {{ util.form_input_submit(value="Speichern", cancellink=cdedblink('ml/show_mailinglist')) }}
    </form>
{% endblock %}
