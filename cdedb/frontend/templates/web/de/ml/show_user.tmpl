{% extends "web/de/ml/base.tmpl" %}
{% import "web/de/util.tmpl" as util with context %}
{% block title %}{{ data['given_names']|e }} {{ data['family_name']|e }}{% endblock %}
{% block content %}
    {% if data['id'] == user.persona_id or is_admin %}
        <p>
            {% if is_admin %}
                <a href="{{ cdedblink('ml/admin_change_user_form')|e }}">Bearbeiten</a>
            {% else %}
                <a href="{{ cdedblink('ml/change_user_form')|e }}">Bearbeiten</a>
            {% endif %}
        </p>
    {% endif %}
    <table>
        <tr>
            <td>Name</td>
            <td>
                {{ data['given_names']|e }}
                {{ data['family_name']|e }}
            </td>
        </tr>
        <tr>
            <td>Rufname</td>
            <td>{{ data['display_name']|e }}</td>
        </tr>
        <tr>
            <td>CdEDB-ID</td>
            <td>{{ data['id']|cdedbid|e }}</td>
        </tr>
        <tr>
            <td>Email</td>
            <td>
                {{ data['username']|e }}
                {% if is_admin and data['id'] != user.persona_id %}
                    <a href="{{ cdedblink('core/admin_username_change_form')|e }}">Email ändern</a>
                {% else %}
                    <a href="{{ cdedblink('core/change_username_form')|e }}">Email ändern</a>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>CdE-Wolken-Zugriff</td>
            <td>
                {{ util.deko_checkbox(checked=data['cloud_account']) }}
            </td>
        </tr>
        {% if is_admin %}
            <tr>
                <td>Account aktiv</td>
                <td>
                    {{ util.deko_checkbox(checked=data['is_active'], anid='activity_checkbox') }}
                    {% if data['is_active'] %}
                        <form action="{{ cdedblink('core/toggle_activity', {'activity': False})|e }}" method="POST"
                         id="activitytoggleform">
                            <div>{{ util.input_submit(value="Account deaktivieren") }}</div>
                        </form>
                    {% else %}
                        <form action="{{ cdedblink('core/toggle_activity', {'activity': True})|e }}" method="POST"
                         id="activitytoggleform">
                            <div>{{ util.input_submit(value="Account aktivieren") }}</div>
                        </form>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Privilegien-Bits</td>
                <td>
                    {{ data['db_privileges_ascii']|e }}
                    {% if "admin" in user.roles %}
                        <a href="{{ cdedblink("core/adjust_privileges_form")|e }}">Ändern</a>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Notizen</td>
                <td>{{ data['notes']|e|linebreaks }}</td>
            </tr>
        {% endif %}
    </table>

    {% if data['id'] == user.persona_id or is_admin %}
        <p>
            {% if is_admin %}
                <a href="{{ cdedblink('ml/admin_change_user_form')|e }}">Bearbeiten</a>
            {% else %}
                <a href="{{ cdedblink('ml/change_user_form')|e }}">Bearbeiten</a>
            {% endif %}
        </p>
    {% endif %}
    {% if is_admin %}
        <form action="{{ cdedblink('core/admin_password_reset')|e }}" method="POST" id="adminpasswordresetform">
            <div>{{ util.input_submit(value="Passwort zurücksetzen") }}</div>
        </form>
    {% endif %}
{% endblock %}
