{# This template provides a set of standard macros which should be used to
   create html-elements. #}

{% macro checkbox_checked() %}
   <input type="checkbox" checked disabled>
{% endmacro %}

{% macro checkbox_unchecked() %}
   <input type="checkbox" disabled>
{% endmacro %}

{% macro input_hidden(name, value=None, defaultvalue='') %}
    {% if value is none %}
        <input type="hidden" name="{{ name|e }}" value="{{ values.get(name, defaultvalue)|e }}" >
    {% else %}
        <input type="hidden" name="{{ name|e }}" value="{{ value|e }}" >
    {% endif %}
{% endmacro %}

{% macro input_file(name, displayerrors=True, accept='') %}
    <span class="stacking">
        {% if displayerrors %}
            {% for error in errors.get(name, []) %}
                {% if error %}
                    {{ i18n(error|string)|e }}<br>
                {% endif %}
            {% endfor %}
        {% endif %}
        <input type="file" name="{{ name|e }}" {% if accept %} accept="{{ accept|e }}" {% endif %}>
    </span>
{% endmacro %}

{% macro input_text(name, label='', displayerrors=True, readonly=False, defaultvalue='') %}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        <label>
            {{ label|e }}
            <span class="stacking">
                {% if displayerrors %}
                    {% for error in errors.get(name, []) %}
                        {% if error %}
                            {{ i18n(error|string)|e }}<br>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if readonly %}
                    <span>{{ values.get(name, defaultvalue)|e }}</span>
                    <input type="hidden" name="{{ name|e }}" value="{{ values.get(name, defaultvalue)|e }}" >
                {% else %}
                    <input type="text" name="{{ name|e }}" value="{{ values.get(name, defaultvalue)|e }}" >
                {% endif %}
            </span>
        </label>
    </span>
{% endmacro %}

{% macro tab_input_text(name, label='', displayerrors=True, readonly=False, defaultvalue='') %}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td><label for="{{ name|e }}">{{ label|e }}</label></td>
        <td>
            {% if displayerrors %}
                {% for error in errors.get(name, []) %}
                    {{ i18n(error|string)|e }}<br>
                {% endfor %}
            {% endif %}
            {% if readonly %}
                <span>{{ values.get(name, defaultvalue)|e }}</span>
                <input type="hidden" name="{{ name|e }}" value="{{ values.get(name, defaultvalue)|e }}" >
            {% else %}
                <input type="text" name="{{ name|e }}" value="{{ values.get(name, defaultvalue)|e }}" >
            {% endif %}
        </td>
    </tr>
{% endmacro %}

{% macro input_password(name="password", label="", readonly=False) %}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        <label>
            {{ label|e }}
            {% if readonly %}
                <span>******</span>
                <input type="hidden" name="{{ name|e }}" value="" >
            {% else %}
                <input type="password" name="{{ name|e }}" value="" >
            {% endif %}
        </label>
    </span>
{% endmacro %}

{% macro tab_input_password(name="password", label="", readonly=False) %}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td><label for="{{ name|e }}">{{ label|e }}</label></td>
        <td>
            {% if readonly %}
                <span>******</span>
                <input type="hidden" name="{{ name|e }}" value="" >
            {% else %}
                <input type="password" name="{{ name|e }}" value="" >
            {% endif %}
        </td>
    </tr>
{% endmacro %}

{% macro input_checkbox(name, label="", value=True, readonly=False, defaultvalue='') %}
{# This is the version for single checkboxes as opposed to input_checkboxes(). #}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        <label>
            <input type="checkbox" name="{{ name|e }}" value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} checked {% endif %} {% if readonly %} disabled {% endif %} >
            {{ label|e }}
        </label>
    </span>
{% endmacro %}

{% macro tab_input_checkbox(name, label="", value=True, readonly=False, defaultvalue='') %}
{# This is the version for single checkboxes as opposed to tab_input_checkboxes(). #}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td colspan="2">
                <label>
                <input type="checkbox" name="{{ name|e }}" value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} checked {% endif %} {% if readonly %} disabled {% endif %} >
                {{ label|e }}
            </label>
        </td>
    </tr>
{% endmacro %}

{% macro input_checkboxes(name, entries, readonly=False, defaultvalue=[]) %}
{# This is the version for multiple checkboxes as opposed to input_checkbox().
   entries is of type [(str, str)]. #}

    <span {% if name in errors %} class="errorInput" {% endif %} >
        <span class="stacking">
            {% for value, label in entries %}
                <label>
                    <input type="checkbox" name="{{ name|e }}" value="{{ value|e }}" {% if value in values.get(name, defaultvalue) %} checked {% endif %} {% if readonly %} disabled {% endif %} >
                    {{ label|e }}
                </label>
            {% endfor %}
        </span>
    </span>
{% endmacro %}

{% macro tab_input_checkboxes(name, entries, readonly=False, defaultvalue=[]) %}
{# This is the version for multiple checkboxes as opposed to tab_input_checkbox().
   entries is of type [(str, str)]. #}

    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td colspan="2">
            {% for value, label in entries %}
                <label>
                    <input type="checkbox" name="{{ name|e }}" value="{{ value|e }}" {% if value in values.get(name, defaultvalue) %} checked {% endif %} {% if readonly %} disabled {% endif %} >
                    {{ label|e }}
                </label>
            {% endfor %}
        </td>
    </tr>
{% endmacro %}

{% macro input_radio(name, entries, title="", readonly=False, defaultvalue=None) %}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        {{ title|e }}
        {% if readonly %}
            <span>{{ values.get(name, defaultvalue)|e }}</span>
        {% else %}
            <span class="stacking">
                {% for value, label in entries %}
                    <label>
                        <input type="radio" name="{{ name|e }}" value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} checked {% endif %} >
                        {{ label|e }}
                    </label><br>
                {% endfor %}
            </span>
        {% endif %}
    </span>
{% endmacro %}

{% macro tab_input_radio(name, entries, title="", readonly=False, defaultvalue=None) %}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td> {{ title|e }} </td>
        <td>
            {% if readonly %}
                <span>{{ values.get(name, defaultvalue)|e }}</span>
            {% else %}
                {% for value, label in entries %}
                    <label>
                        <input type="radio" name="{{ name|e }}" value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} checked {% endif %} >
                        {{ label|e }}
                    </label><br>
                {% endfor %}
            {% endif %}
        </td>
    </tr>
{% endmacro %}

{% macro input_select(name, entries, title="", readonly=False, defaultvalue=None) %}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        {{ title|e }}
        {% if readonly %}
            <span>{{ values.get(name, defaultvalue)|e }}</span>
        {% else %}
            <select name="{{ name|e }}" >
                {% for value, label in entries %}
                    <option value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} selected {% endif %} >
                        {{ label|e }}
                    </option>
                {% endfor %}
            </select>
        {% endif %}
    </span>
{% endmacro %}

{% macro tab_input_select(name, entries, title="", readonly=False, defaultvalue=None) %}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td> {{ title|e }} </td>
        <td>
            {% if readonly %}
                <span>{{ values.get(name, defaultvalue)|e }}</span>
            {% else %}
                <select name="{{ name|e }}" >
                    {% for value, label in entries %}
                        <option value="{{ value|e }}" {% if values.get(name, defaultvalue) == value %} selected {% endif %} >
                            {{ label|e }}
                        </option>
                    {% endfor %}
                </select>
            {% endif %}
        </td>
    </tr>
{% endmacro %}

{% macro input_multiselect(name, entries, title="", readonly=False, defaultvalue=[]) %}
    <span {% if name in errors %} class="errorInput" {% endif %} >
        {{ title|e }}
        {% if readonly %}
            <span>{{ values.get(name, defaultvalue)|join(", ")|e }}</span>
        {% else %}
            <select name="{{ name|e }}" multiple >
                {% for value, label in entries %}
                    <option value="{{ value|e }}" {% if value in values.get(name, defaultvalue) %} selected {% endif %} >
                        {{ label|e }}
                    </option>
                {% endfor %}
            </select>
        {% endif %}
    </span>
{% endmacro %}

{% macro tab_input_multiselect(name, entries, title="", readonly=False, defaultvalue=[]) %}
    <tr {% if name in errors %} class="errorInput" {% endif %} >
        <td> {{ title|e }} </td>
        <td>
            {% if readonly %}
                <span>{{ values.get(name, defaultvalue)|join(", ")|e }}</span>
            {% else %}
                <select name="{{ name|e }}" multiple >
                    {% for value, label in entries %}
                        <option value="{{ value|e }}" {% if value in values.get(name, defaultvalue) %} selected {% endif %} >
                            {{ label|e }}
                        </option>
                    {% endfor %}
                </select>
            {% endif %}
        </td>
    </tr>
{% endmacro %}

{% macro input_submit(value, name="submitform", readonly=False) %}
    <input type="submit" name="{{ name|e }}" value="{{ value|e }}" {% if readonly %} disabled {% endif %}>
{% endmacro %}

{% macro format_query(spec, titles, choices, output_selection=True) %}
    {% with OPERATOR_LABELS = {0 : "nicht definiert",
                               1 : "definiert",
                               2 : "gleich",
                               3 : "eines aus",
                               4 : "ähnlich",
                               5 : "ähnlich zu einem aus",
                               6 : "regex",
                               7 : "enthält alle",
                               10 : "kleiner",
                               11 : "kleinergleich",
                               12 : "zwischen",
                               13 : "größergleich",
                               14 : "größer",} %}
        <table>
            {% for field in spec %}
                <tr {% if field in errors %} class="errorInput" {% endif %} >
                    <td>
                        {% with name, value = ("qsel_{}".format(field), True) %}
                            {% if output_selection %}
                                <input type="checkbox" name="{{ name|e }}" value="{{ value|e }}" {% if values.get(name) == value %} checked {% endif %} >
                            {% else %}
                                <input type="hidden" name="{{ name|e }}" value="{{ value|e }}" >
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td> {{ titles[field]|e }} </td>
                    <td>
                        {% with name = "qop_{}".format(field) %}
                            <select name="{{ name|e }}" >
                                {% for op in VALID_QUERY_OPERATORS[spec[field]] %}
                                    <option value="{{ op.value|e }}" {% if values.get(name) == op.value %} selected {% endif %} >
                                        {{ OPERATOR_LABELS[op.value]|e }}
                                    </option>
                                {% endfor %}
                            </select>
                        {% endwith %}
                    </td>
                    <td>
                        {% with name = "qval_{}".format(field) %}
                            {% if field in choices %}
                                <select name="{{ name|e }}" >
                                    <option value="" > </option>
                                    {% for value, label in choices[field] %}
                                        <option value="{{ value|e }}" {% if values.get(name) == value %} selected {% endif %} >
                                            {{ label|e }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% elif spec[field] == "bool" %}
                                <select name="{{ name|e }}" >
                                    <option value="" > </option>
                                    <option value="True" {% if values.get(name) == True %} selected {% endif %} > wahr </option>
                                    <option value="False" {% if values.get(name) == False %} selected {% endif %} > falsch </option>
                                </select>
                            {% else %}
                                <input type="text" name="{{ name|e }}", value="{{ values.get(name, '')|e }}" >
                            {% endif %}
                        {% endwith %}
                    </td>
                </tr>
            {% endfor %}
            {% for title, name in (("1. Sortierung nach", "qord_primary"), ("2. Sortierung nach", "qord_secondary"), ("3. Sortierung nach", "qord_tertiary"))%}
                <tr>
                    <td colspan="2"> {{ title|e }} </td>
                    <td colspan="2">
                        <select name="{{ name|e }}" >
                            <option value="" > </option>
                            {% for field in spec %}
                                <option value="{{ field|e }}" {% if values.get(name) == field %} selected {% endif %} > {{ titles[field]|e }} </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% endwith %}
{% endmacro %}
