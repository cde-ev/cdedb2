{% set sidenav_active='cde_member_stats' %}
{% extends "web/cde/base.tmpl" %}
{% block title %}
    {% trans %}
        Member Stats
    {% endtrans %}
{% endblock %}
{% block breadcrumb %}
    {{ util.breadcrumb_link(cdedblink("cde/index"), gettext("Members")) }}
    {{ util.breadcrumb_link(cdedblink("cde/member_stats"), gettext("Member Stats"), active=True) }}
{% endblock %}
{% block content %}
    <div id="cde-simple-stats">
        <table class="table table-hover table-condensed">
            {% for key, value in simple_stats.items() %}
                <tr>
                    {% if "num_of" in key %}
                    <td class="indent"></td>
                    {% endif %}
                    <td {% if not "num_of" in key %}colspan="2"{% endif %}>
                        {{ gettext(key) }}
                    </td>
                    <td id="simple-stats-{{ key }}">
                        {{ value }}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <hr />

    <div id="cde-year-stats">
        <table class="table table-hover table-condensed" id="year-stats">
            <thead>
                <tr>
                    <td></td>
                    {% for key, value in year_stats.items() %}
                    <td>{{ gettext(key) }}</td>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% for year in all_years|sort %}
                <tr>
                    <td>{{ year }}</td>
                    {% for key, value in year_stats.items() %}
                    <td id="year-stats-{{ key }}-{{ year }}">{{ value.get(year, "â€”") }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="cde-complex-stats">
        {% for view, view_stats in other_stats.items() %}
            {% if view == "members_by_country" %}
                {{ stat_table(view, view_stats, util.gettext_country) }}
            {% else %}
                {{ stat_table(view, view_stats) }}
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% macro stat_table(view, view_stats, processing="") %}
    <table class="table table-hover table-condensed" id="complex-stats-{{ view }}">
        <thead>
            <tr>
                <td></td>
                <td>{{ gettext(view) }}</td>
            </tr>
        </thead>
        <tbody>
        {% for datum, num in view_stats.items() %}
            <tr>
                <td>
                    {% if processing %}
                        {{ processing(datum) }}
                    {% else %}
                        {{ datum }}
                    {% endif %}
                </td>
                <td id="complex-stats-{{ view }}-{{ datum }}">
                    {{ num }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endmacro %}
