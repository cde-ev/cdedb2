{% extends "web/cde/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title -%}
    {% trans -%}
        New Direct Debit Authorization
    {%- endtrans %}
    ({{ ambience['persona']['given_names']|e }} {{ ambience['persona']['family_name']|e }})
{%- endblock %}
{% block heading -%}
    <h1>
        {% trans -%}New Direct Debit Authorization{%- endtrans %}
        <small>{{ util.make_icon('user') }} {{ "{} {}".format(ambience['persona']['given_names'],
                                                             ambience['persona']['family_name'])|e }}</small>
    </h1>
{%- endblock %}

{% set sidenav_active='cde_lastschrift' %}
{% block breadcrumb %}
    {{ super() }}
    {% if is_admin %}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_index"), gettext("Direct Debit Authorizations")) }}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_show", {'persona_id': values['persona_id']}),
                                "{} {}".format(ambience['persona']['given_names'],
                                               ambience['persona']['family_name'])|e,
                                icon="euro") }}
    {% else %}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_show", {'persona_id': values['persona_id']}),
                                gettext("existing Direct Debit Authorization")) }}
    {% endif %}
    {{ util.breadcrumb_link(cdedblink("cde/lastschrift_create", {'persona_id': values['persona_id']}),
                            gettext("Create"), active=True) }}
{% endblock %}

{% block content %}
    <form action="{{ cdedblink('cde/lastschrift_create')|e }}" method="POST" id="createlastschriftform"
            class="form-horizontal">
        {{ util.form_input_text(name="amount", label=gettext("Amount"), type="number", attributes='min="0" step="0.01"') }}
        {{ util.form_input_text(name="iban", label=gettext("IBAN")) }}
        {{ util.form_input_text(name="account_owner", label=gettext("Account holder (if different)")) }}
        {{ util.form_input_textarea(name="account_address", label=gettext("Account holder's address (if different)")) }}
        {{ util.form_input_text(name="max_dsa", label=gettext("Maximum DSA-Share"), type="number", attributes='min="0" max="1"') }}
        {{ util.form_input_textarea(name="notes", label=gettext("Notes"), rows="5",
                                    info=gettext("Supports reStructuredText")) }}
        {{ util.form_input_submit(value=gettext("Create"), cancellink=cdedblink(
            'cde/lastschrift_show', {'person_id': ambience['persona']['persona_id']})) }}
    </form>
{% endblock %}
