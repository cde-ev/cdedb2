{% extends "web/cde/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title -%}
    {% trans -%}
        New Direct Debit Authorization
    {%- endtrans %}
    ({{ ambience['persona']['given_names'] }} {{ ambience['persona']['family_name'] }})
{%- endblock %}
{% block heading -%}
    <h1>
        {% trans -%}New Direct Debit Authorization{%- endtrans %}
        <small>
            {{ util.make_icon('user') }} {{ ambience['persona']['given_names'] }}
            {{ ambience['persona']['family_name'] }}
        </small>
    </h1>
{%- endblock %}

{% set sidenav_active='cde_lastschrift' %}
{% block breadcrumb %}
    {{ super() }}
    {# TODO this seems wrong to me #}
    {% if is_admin %}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_index"), gettext("Direct Debit Authorizations",
                                readonly="finance" not in user.admin_views)) }}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_show", {'persona_id': values['persona_id']}),
                                "{} {}".format(ambience['persona']['given_names'],
                                               ambience['persona']['family_name']),
                                icon="euro",
                                readonly="finance" not in user.admin_views) }}
    {% else %}
        {{ util.breadcrumb_link(cdedblink("cde/lastschrift_show", {'persona_id': values['persona_id']}),
                                gettext("existing Direct Debit Authorization")) }}
    {% endif %}
    {{ util.breadcrumb_link(cdedblink("cde/lastschrift_create", {'persona_id': values['persona_id']}),
                            gettext("Create"), active=True) }}
{% endblock %}

{% block content %}
    <form action="{{ cdedblink('cde/lastschrift_create') }}" method="POST" id="createlastschriftform"
            class="form-horizontal">
        {{ util.anti_csrf_token('cde/lastschrift_create') }}
        {{ util.form_input_text(name="amount", label=gettext("Amount"), type="number", attributes='min="0" step="0.01"'|s) }}
        {{ util.form_input_text(name="iban", label=gettext("IBAN")) }}
        {{ util.form_input_text(name="account_owner", label=gettext("Account holder (if different)")) }}
        {{ util.form_input_textarea(name="account_address", label=gettext("Account holderâ€™s address (if different)")) }}
        {{ util.form_input_textarea(name="notes", label=gettext("Notes"), rows="5",
                                    info=gettext("Supports %(infolink)s.")|format(
                                    infolink=util.href(docurl("Handbuch_Markdown"), gettext("Markdown"), title=gettext("Short Markdown summary")))|s) }}
        {{ util.form_input_submit(value=gettext("Create"), cancellink=cdedblink(
            'cde/lastschrift_show', {'person_id': ambience['persona']['persona_id']})) }}
    </form>
{% endblock %}
