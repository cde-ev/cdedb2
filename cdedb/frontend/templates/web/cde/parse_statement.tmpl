{% set sidenav_active='cde_parse' %}
{% extends "web/cde/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block scripts %}{{ util.cdedb_script('csv-tools') }}{% endblock %}
{% block title %}
    {% trans -%}
        Parse Bank Statement
    {%- endtrans %}
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("cde/parse_statement_form"), gettext("Parse Bank Statement"), active=True) }}
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('cde/parse_statement')|e }}" method="POST" id="statementform">
        {{ util.input_hidden("checksum") }}
        {{ util.form_input_textarea(name="statement", label=gettext("Statement"), horizontal=False,
                rows=8, anid="input-data") }}

        <p class="help-block">
            {{ util.make_icon('info-sign') }}
            {% trans -%}Directly paste the Bank Statement from Bank f√ºr Sozialwirtschaft here.{%- endtrans %}
        </p>

        {{ util.form_input_submit(value=gettext("Validate"), horizontal=False) }}

        {% if data %}
            {% if "files" in data %}
                {% for key, value in data["files"]|dictsort %}
                    {{ util.href(cdedblink('cde/parse_download', {"path": value, "filename": key + ".csv"}),
                        gettext("Download {}.csv ").format(key),
                        aclass="btn btn-info btn-sm", icon="download") }} <br>
                {% endfor %}
            {% endif %}
        {% endif %}
        <br>
        <br>
        {% if problems %}
            {{ problems }}
        {% endif %}

        {% if data %}
            {% for key, value in data|dictsort %}
                {% if key == "transactions" %}
                    {% for t in value %}
                        {{ t|string|replace("\n", "<br>")|replace("\t", "    ") }}
                        <br>
                        <br>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% endif %}
    </form>
{% endblock %}
