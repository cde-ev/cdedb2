{% set sidenav_active='event_registration' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block scripts %}{{ util.cdedb_script('cdedb_helper.js') }}{% endblock %}
{% set jshint='weak' %}
{% block title %}
    {% trans field=ambience['event']['fields'][values['field_id']|int]['field_name'],
             title=ambience['event']['title'] -%}
        Set Field {{ field }} ({{ title }})
    {% endtrans %}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans field="<em>%s</em>"|s|format(ambience['event']['fields'][values['field_id']|int]['field_name']|e) %}
            Set {{ field }}
        {% endtrans %}
        <small>{{ util.make_icon('chalkboard-teacher') }} {{ ambience['event']['title'] }}</small>
    </h1>
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="chalkboard-teacher") }}
{{ util.breadcrumb_link(cdedblink("event/registration_query"), gettext("Registrations")) }}
{{ util.breadcrumb_link(cdedblink("event/field_set_select"), gettext("Set Field")) }}
{{ util.breadcrumb_link(cdedblink("event/field_set_form"),
                        ambience['event']['fields'][values['field_id']|int]['field_name'], active=True, icon="tag") }}
{% endblock %}
{% block content %}
    {% if ordered %}
        <form action="{{ cdedblink('event/field_set') }}" method="POST" id="fieldform" class="form-horizontal">
            {{ util.anti_csrf_token('event/field_set') }}
            {% for anid in ordered %}
                {{ util.form_event_field_input(
                    ambience['event']['fields'][values['field_id']|int], name="input{}".format(anid),
                    label=labels[anid],
                    force_label=True) }}
            {% endfor %}
            {{ util.input_hidden(name="field_id") }}
            {{ util.input_hidden(name="ids") }}
            {{ util.form_input_submit(value=gettext("Save"), cancellink=cdedblink('event/registration_query')) }}
        </form>
    {% else %}
        <p>
            {% trans %}No registrations found.{% endtrans %}
        </p>
    {% endif %}
    <script nonce="{{ csp_nonce }}">
        $('#fieldform').cdedbProtectChanges();
    </script>
{% endblock %}
