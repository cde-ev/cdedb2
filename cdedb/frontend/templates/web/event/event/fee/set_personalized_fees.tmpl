{% set sidenav_active='event_fees' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block scripts %}
    {{ util.cdedb_script('cdedb_helper.js') }}
    {{ util.cdedb_script('cdedb_multiset.js') }}
{% endblock %}
{% set jshint='weak' %}

{% block title %}
    {% trans fee_title=ambience['fee'].title, event_title=ambience['event'].title %}
        Set Personalized Fees for {{ fee_title }} ({{ event_title }})
    {% endtrans %}
{% endblock %}

{% block breadcrumb %}
    {{ super() }}
    {{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event'].title, icon="chalkboard-teacher") }}
    {{ util.breadcrumb_link(cdedblink("event/fee_summary"), gettext("Fees")) }}
    {{ util.breadcrumb_link("", ambience['fee'].title, icon="coins", readonly=True) }}
    {{ util.breadcrumb_link(cdedblink("event/set_personalized_fees"), gettext("Set Amounts"), icon="edit", active=True) }}
{% endblock %}

{% block heading %}
    {{ util.context_heading(gettext("Set Personalized Fees for %(fee_title)s")|format(fee_title=ambience['fee'].title),
                            ambience['event'].title, 'chalkboard-teacher') }}
{% endblock %}

{% block content %}

    <form action="{{ cdedblink('event/set_personalized_fees') }}" method="POST" id="setpersonalizedfeeamountsform" class="form-horizontal">
        {{ util.anti_csrf_token('event/set_personalized_fees') }}
        {{ util.input_hidden('registration_ids', registration_ids|join(',')) }}
        {# Already sorted #}
        {% for reg in registrations %}
            {{ util.form_input_text("amount" + reg['id']|string, label=util.persona_name(personas[reg['persona_id']]),
                                    placeholder="", type="number", aclass="no-number-arrows",
                                    attributes='style="width:6em;" step="0.01"'|s,
                                    outerclass='multiset-input') }}
        {% endfor %}

        {{ util.form_input_submit(label=gettext("Save"), cancellink=cdedblink("event/fee_summary")) }}
    </form>

    <script nonce="{{ csp_nonce }}">
        $('#setpersonalizedfeeamountsform').cdedbProtectChanges().multiset(
            '{{ util.make_icon("trash-alt") }}', '{{ gettext("Delete") }}',
            '{{ util.make_icon("redo") }}', '{{ gettext("Restore") }}',
        );
    </script>
{% endblock %}
