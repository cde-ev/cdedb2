{% set sidenav_active='event_list' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}Veranstaltungen verwalten{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/list_db_events"), "Veranstaltungen verwalten", active="True") }}
{% endblock %}

{% macro format_entry(event) %}
    <div class="row list-group-item{% if event['is_archived'] %} list-group-item-muted{% endif %}">
        <div class="col-sm-4">
            {{ util.href(cdedblink("event/show_event", {'event_id': event['id']}), event['title']) }}
        </div>
        <div class="col-sm-5 small">
            {{ event['begin']|date(lang=lang)|e }}&#8239;â€“&#8239;{{ event['end']|date(lang=lang)|e }}
            {% if event['parts']|length > 1 %}
                ({{ event['parts']|length }} Teile)
            {% endif %}
        </div>
        <div class="col-sm-3 small">
            <a href="{{ cdedblink('event/registration_query', {'event_id': event['id']})|e }}">{{ event['registrations'] }} Anmeldungen</a>,
            {{ event['orgas']|length }} Orga{% if event['orgas']|length != 1 %}s{% endif %}
        </div>
    </div>
{% endmacro %}
{% block content %}
    <div class="p">
        {{ util.href(cdedblink("event/create_event_form"), "Veranstaltung anlegen", aclass="btn btn-success btn-sm",
                icon="plus") }}
    </div>
    
    <h3>Aktuelle Veranstaltungen</h3>
    <div class="list-group list-group-hover list-group-condensed">
        {% for event_id, entry in events|dictsort|reverse %}
            {% if not entry['is_archived'] %}
                {{ format_entry(entry) }}
            {% endif %}
        {% endfor %}
    </div>

    <h3>Archivierte Veranstaltungen</h3>
    <div class="list-group list-group-hover list-group-condensed">
        {% for event_id, entry in events|dictsort|reverse %}
            {% if entry['is_archived'] %}
                {{ format_entry(entry) }}
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}
