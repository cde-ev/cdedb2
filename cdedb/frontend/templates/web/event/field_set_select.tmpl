{% set sidenav_active='event_registration' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}Feld auswählen ({{ ambience['event']['title']|e }}){% endblock %}
{% block heading %}
    <h1 class="title">
        Datenfeld setzen
        <small>{{ util.make_icon('blackboard') }} {{ ambience['event']['title']|e }}</small>
    </h1>
{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_query"), "Anmeldungen") }}
{{ util.breadcrumb_link(cdedblink("event/field_set_select"), "Datenfeld setzen", active=True) }}
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('event/field_set_select')|e }}" method="GET" id="selectfieldform"
          class="form-horizontal">
        {# jinja does not support list comprehension ... #}
        {% set myentries = [] %}
        {% for field_id, field in ambience['event']['fields']|dictsort %}
            {% if field['association'] == enums['FieldAssociations'].registration %}
                {{ myentries.append((field_id, field['field_name']))|e }}
            {% endif %}
        {% endfor %}
        {{ util.form_input_select("field_id", label="Feld", entries=myentries, small=True) }}
        {{ util.input_hidden(name="reg_ids", value=reg_ids|join(',')) }}
        {{ util.form_input_submit(value="Anzeigen", cancellink=cdedblink('event/registration_query'), icon="", small=True) }}
    </form>

    {% if reg_ids %}
        <h4 class="mosp">Zu ändernde Teilnehmer/Anmeldungen</h4>
        <ul>
            {% for reg_id, registration in registrations|dictsort %}
                <li>{{ personas[registration['persona_id']]['given_names']|e }}
                    {{ personas[registration['persona_id']]['family_name']|e }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}
