{% set sidenav_active='event_registration' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}
    {% trans title=ambience['event']['title'] -%}
        Select Field ({{ title }})
    {%- endtrans %}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans -%}
            Select Field
        {%- endtrans %}
        <small>{{ util.make_icon('blackboard') }} {{ ambience['event']['title'] }}</small>
    </h1>
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_query"), gettext("Registrations")) }}
{{ util.breadcrumb_link(cdedblink("event/field_set_select"), gettext("Set Field"), active=True) }}
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('event/field_set_select') }}" method="GET" id="selectfieldform"
          class="form-horizontal">
        {#- jinja does not support list comprehension ... #}
        {%- set myentries = [] %}
        {%- for field_id, field in ambience['event']['fields']|dictsort
                if field['association'] == enums['FieldAssociations'].registration %}
            {%- do myentries.append((field_id, field['field_name'])) -%}
        {%- endfor %}
        {{ util.form_input_select("field_id", label=gettext("Field"), entries=myentries, small=True) }}
        {{ util.input_hidden(name="reg_ids", value=reg_ids|join(',')) }}
        {{ util.form_input_submit(value=gettext("Continue"), cancellink=cdedblink('event/registration_query'), icon="pencil", small=True) }}
    </form>

    {% if reg_ids %}
        <h4 class="mosp">{% trans -%}Participants/Registrations to be changed{%- endtrans %}</h4>
        <ul>
            {% for reg_id, registration in registrations|dictsort %}
                <li>{{ personas[registration['persona_id']]['given_names'] }}
                    {{ personas[registration['persona_id']]['family_name'] }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}
