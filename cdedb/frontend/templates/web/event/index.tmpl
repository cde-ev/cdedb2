{% set sidenav_active='event_index' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}
    {% trans %}
    	Events
    {% endtrans %}
{% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), gettext("Events"), active=True) }}
{% endblock %}
{% block content %}
    <h3>{% trans %}Current Events{% endtrans %}</h3>
    {% if open_events %}
        <ul class="spaced" id="current-events">
            {% for event_id, event in open_events|keydictsort(EntitySorter.event) %}
                <li>
                    {{ util.href(cdedblink("event/show_event", {"event_id": event_id}), event['title']) }}
                    <br />
                    {{ event['begin']|date(lang=lang) }}&#8239;–&#8239;{{ event['end']|date(lang=lang) }},
                    {% if now() <= event['registration_start'] %}
                        Registration in future.
                    {% elif not event['registration_soft_limit'] is none and now() <= event['registration_soft_limit'] %}
                        Registration is open.
                    {% elif not event['registration_hard_limit'] is none and now() <= event['registration_hard_limit'] %}
                        Late-Registration is open.
                    {% elif event['begin'] <= now() <= event['end'] %}
                        Event is happening.
                    {% elif event['end'] <= now() %}
                        Event is past.
                    {% endif %}
                    <br />
                    {% if event['registration'] %}
                        {% trans link=util.href(cdedblink('event/registration_status', {'event_id': event_id}),
                                     gettext("registered")) -%}
                            (Already {{ link }})
                        {% endtrans %}
                        {%- if event['use_questionnaire'] %}
                            &bull;
                            {{ util.href(cdedblink('event/questionnaire', {'event_id': event_id}),
                                         gettext("Questionnaire"), icon='edit') -}}
                        {% endif -%}
                    {% elif event['is_open'] %}
                        {{ util.href(cdedblink('event/register_form', {'event_id': event_id}),
                            gettext("Register"), icon='log-in') }}
                        {% if not event['registration_soft_limit'] is none %}
                            {% if now() <= event['registration_soft_limit'] %}
                                {% trans date=event['registration_soft_limit']|datetime(lang=lang) %}
                                    (Until {{ date }})
                                {% endtrans %}
                            {% elif event['registration_hard_limit'] %}
                                {% trans date=event['registration_hard_limit']|datetime(lang=lang) %}
                                    (Late Registrations until {{ date }})
                                {% endtrans %}
                            {% else %}
                                {% trans %}
                                    (Only late Registrations possible)
                                {% endtrans %}
                            {% endif %}
                        {% elif not event['registration_hard_limit'] is none %}
                            {% trans date=event['registration_hard_limit']|datetime(lang=lang) %}
                                (Until {{ date }})
                            {% endtrans %}
                        {% endif %}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">
            {% trans %}There are currently no event registrations open.{% endtrans %}
        </p>
    {% endif %}

    {% if orga_events %}
        <h3>{% trans %}Organized Events{% endtrans %}</h3>
        <ul class="spaced" id="organized-events">
            {% for event_id, entry in orga_events|keydictsort(EntitySorter.event) %}
                <li>
                    {{ util.href(cdedblink("event/show_event", {"event_id": event_id}), entry['title']) }}
                    <br />
                    {{ entry['begin']|date(lang=lang) }}–{{ entry['end']|date(lang=lang) }}
                    <br />
                    <span class="small">
                        {{ util.href(cdedblink('event/registration_query', {'event_id': event_id}),
                                     gettext("Registrations"), icon='list') }}
                        &bull;
                        {{ util.href(cdedblink('event/stats', {'event_id': event_id}),
                                     gettext("Statistics"), icon='stats') }}
                        {% if entry['tracks'] %}
                            &bull;
                            {{ util.href(cdedblink('event/course_stats', {'event_id': event_id}),
                                         gettext("Courses"), icon='book') }}
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if other_events %}
        <h3>{% trans %}Other Events{% endtrans %}</h3>
        <ul class="spaced" id="other-events">
            {% for event_id, event in other_events|keydictsort(EntitySorter.event) %}
                <li>
                    {{ util.href(cdedblink("event/show_event", {"event_id": event_id}), event['title']) }}
                    <br />
                    {{ event['begin']|date(lang=lang) }}&#8239;–&#8239;{{ event['end']|date(lang=lang) }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if 'cde' in user.roles %}
        <h3>{% trans %}Past Events (long){% endtrans %}</h3>
        <p id="past-events">
            {% trans link=util.href(cdedblink('cde/list_past_events'), gettext('Past Events (long)'))|s %}
                Previous CdE events, including their courses and participants, can be found at {{ link }} – together with Junior- and SchülerAkademien.
            {% endtrans %}
        </p>
    {% endif %}
{% endblock %}
