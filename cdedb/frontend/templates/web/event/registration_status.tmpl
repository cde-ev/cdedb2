{% set sidenav_active='event_register' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}
    {% trans title=ambience['event']['title'] -%}
    	Your Registration ({{ title }})
    {%- endtrans %}
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_status"), gettext("My Registration"), active=True) }}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans -%}Your Registration{%- endtrans %}
        <small>{{ util.make_icon('blackboard') }} {{ ambience['event']['title'] }}</small>
    </h1>
{% endblock %}
{% block content %}
    {% if ambience['event']['use_questionnaire'] %}
        <div class="alert alert-warning">
             {{ util.make_icon('info-sign') }}
             {% trans link=util.href(cdedblink('event/questionnaire_form'), gettext("questionnaire")) -%}
            	Please fill in the {{ link }} now.
            {%- endtrans %}
        </div>
    {% endif %}
    {% if not registration['payment'] %}
        <h3 class="heading-underline">{% trans -%}Bank Transfer{%- endtrans %}</h3>
        <p>
            {% trans fee=fee|money(lang=lang) -%}
            	Please keep in mind that your Registration will only be complete, once
                you pay your participation fee. Please transfer {{ fee }} to the following
                Account. Please make sure, the recipient does not have to pay any fees,
                especially when paying internationally.
            {%- endtrans %}
        </p>
        <table class="table table-condensed">
            <tbody>
                <tr>
                    <td>{% trans -%}Account holder{%- endtrans %}</td>
                    <td>{% trans -%}CdE e.V.{%- endtrans %}</td>
                </tr>
                <tr>
                    <td>{% trans -%}IBAN{%- endtrans %}</td>
                    <td>{{ ambience['event']['iban']|iban }}</td>
                </tr>
                <tr>
                    <td>{% trans -%}BIC{%- endtrans %}</td>
                    <td>BFSWDE33XXX</td>
                </tr>
                <tr>
                    <td>{% trans -%}Bank{%- endtrans %}</td>
                    <td>Bank für Sozialwirtschaft</td>
                </tr>
                <tr>
                    <td>{% trans -%}Amount{%- endtrans %}</td>
                    <td>{{ fee|money(lang=lang) }}</td>
                </tr>
                <tr>
                    <td>{% trans -%}Reference{%- endtrans %}</td>
                    <td>{{ user['given_names'] }} {{ user['family_name'] }},
                          {{ user['persona_id']|cdedbid }}, {{ ambience['event']['title'] }}</td>
                </tr>
            </tbody>
        </table>
    {% endif %}

    {% if age.is_minor() and not registration['parental_agreement'] %}
        <h3 class="heading-underline">{% trans -%}Parental Consent{%- endtrans %}</h3>
        <p>
            {% trans link=util.href(cdedblink('event/get_minor_form'), gettext("here"), icon='file') -%}
            	You need to send the parental consent form to the Orgas. You can find the form {{ link }}.
            {%- endtrans %}
        </p>
    {% endif %}

    <h3 class="heading-underline">Status</h3>
    <dl class="dl-horizontal">
        {% for part_id, part in registration['parts']|dictsort %}
            <dt>
                {% if ambience['event']['parts']|length > 1 %}
                    {{ ambience['event']['parts'][part_id]['title'] }}
                {% else %}
                    {% trans -%}Registration Status{%- endtrans %}
                {% endif %}
            </dt>
            <dd>{{ gettext(part['status']|enum(enums['RegistrationPartStati'])) }}</dd>
        {% endfor %}
    </dl>

    <h3 class="heading-underline">{% trans -%}Registration Data{%- endtrans %}</h3>
    {% if ambience['event']['registration_soft_limit'] is none or
            ambience['event']['registration_soft_limit'] >= now() %}
        <p>
            {{ util.href(cdedblink("event/amend_registration_form"), gettext("Change"), aclass="btn btn-sm btn-warning",
                         icon='pencil') }}
            {% if not ambience['event']['registration_soft_limit'] is none %}
                {% trans date=ambience['event']['registration_soft_limit']|datetime(lang=lang)-%}
                    Changes can be made until the registration end({{ date }}).
                {%- endtrans %}
            {% endif %}
        </p>
    {% else %}
        <p>
            {% trans -%}
                Registration has ended, therefore no more changes are possible.
                Please contact the Orgas per E-Mail, if you need to change something about your registration.
            {%- endtrans %}
        </p>
    {% endif %}

    <dl class="dl-horizontal">
        <dt>{% trans -%}Mixed Lodging{%- endtrans %}</dt>
        <dd>
            {% if not age.may_mix() %}
                {% trans -%}Mixed Lodging not possible.{%- endtrans %}
            {% else %}
                {% if registration['mixed_lodging'] %}
                    {% trans -%}I agree to mixed lodging.{%- endtrans %}
                {% else %}
                    {% trans -%}I want to be lodged seperated by gender.{%- endtrans %}
                {% endif %}
            {% endif %}
        </dd>
        <dt>{% trans -%}Participant List Consent{%- endtrans %}</dt>
        <dd>
            {% trans consent="<strong>{}</strong> ".format(gettext("do not"))
                            if not registration['list_consent'] else "" -%}
                I {{ consent }}agree that my data, including my name, address and my email, may be sent
                to other participants of this event beforehand.
            {%- endtrans %}
        </dd>
    </dl>
    {% if registration['notes'] %}
        <dl class="dl-horizontal">
            <dt>{% trans -%}Notes{%- endtrans %}</dt>
            <dd>
                {{ registration['notes']|md }}
            </dd>
        </dl>
    {% endif %}

    {% for track_id, track in ambience['event']['tracks']|xdictsort('sortkey') %}
        {% set reg_track = registration['tracks'][track_id] %}
        {% if enums['RegistrationPartStati'](registration['parts'][track['part_id']]['status']).is_involved() %}
            <h4>
                {% trans -%}Course Choices for{%- endtrans %}
                {% if ambience['event']['tracks']|length > 1 %}
                    {{ track['title'] }}
                {% endif %}
            </h4>

            <dl class="dl-horizontal">
                {% if reg_track['course_instructor'] %}
                    <dt>{% trans -%}Instructor of{%- endtrans %}</dt>
                    <dd><em>{{ courses[reg_track['course_instructor']]['title'] }}</em>.</dd>
                {% endif %}
                {% for i in range(track['num_choices']) %}
                    <dt>{{ gettext("{}. choice").format(i + 1) }}</dt>
                    <dd>
                        {% if reg_track['choices']|length > i %}
                            {{ courses[reg_track['choices'][i]]['nr'] }}.
                            {{ courses[reg_track['choices'][i]]['title'] }}
                        {% else %}
                            —
                        {% endif %}
                    </dd>
                {% endfor %}
            </dl>
        {% endif %}
    {% endfor %}
{% endblock %}
