{% set sidenav_active='event_register' %}
{% extends "web/event/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}Deine Anmeldung ({{ ambience['event']['title']|e }}){% endblock %}
{% block breadcrumb %}
{{ util.breadcrumb_link(cdedblink("event/index"), "Veranstaltungen") }}
{{ util.breadcrumb_link(cdedblink("event/show_event"), ambience['event']['title'], icon="blackboard") }}
{{ util.breadcrumb_link(cdedblink("event/registration_status"), "Meine Anmeldung", active=True) }}
{% endblock %}
{% block heading %}
    <h1 class="title">
        Deine Anmeldung
        <small>{{ util.make_icon('blackboard') }} {{ ambience['event']['title']|e }}</small>
    </h1>
{% endblock %}
{% block content %}
    {% if not registration['payment'] %}
        <h3 class="heading-underline">Überweisung</h3>
        <p>
             Beachte bitte, dass deine Anmeldung erst mit Überweisung des
             Teilnehmerbeitrags gültig wird. Überweise dazu {{ fee|money }}
             auf folgendes Konto. Achte bitte bei internationalen
             Überweisungen darauf, dass der Empfänger keine Gebühren zahlen
             muss.
        </p>
        <table class="table table-condensed">
            <tbody>
                <tr>
                    <td>Kontoinhaber</td>
                    <td>CdE e.V.</td>
                </tr>
                <tr>
                    <td>IBAN</td>
                    <td>{{ ambience['event']['iban']|e }}</td>
                </tr>
                <tr>
                    <td>BIC</td>
                    <td>BFSWDE33XXX</td>
                </tr>
                <tr>
                    <td>Kreditinstitut</td>
                    <td>Bank für Sozialwirtschaft</td>
                </tr>
                <tr>
                    <td>Betrag</td>
                    <td>{{ fee|money }}</td>
                </tr>
                <tr>
                    <td>Verwendungszweck</td>
                    <td>{{ user['given_names']|e }} {{ user['family_name']|e }},
                          {{ user['persona_id']|cdedbid|e }}, {{ ambience['event']['title']|e }}</td>
                </tr>
            </tbody>
        </table>
    {% endif %}

    {% if age.is_minor() and not registration['parental_agreement'] %}
        <h3 class="heading-underline">Einverständniserklärung</h3>
        <p>
            Du musst noch die Einverständniserklärung deiner
            Erziehungsberechtigten an die Orgas schicken. Du findest die Vorlage
            {{ util.href(cdedblink('event/get_minor_form'), "hier", icon='file') }}.
        </p>
    {% endif %}

    <h3 class="heading-underline">Status</h3>
    <dl class="dl-horizontal">
        {% for part_id, part in registration['parts']|dictsort %}
            <dt>
                {% if ambience['event']['parts']|length > 1 %}
                    {{ ambience['event']['parts'][part_id]['title']|e }}
                {% else %}
                    Anmeldestatus
                {% endif %}
            </dt>
            <dd>{{ gettext(part['status']|enum(enums['RegistrationPartStati']))|e }}</dd>
        {% endfor %}
    </dl>

    <h3 class="heading-underline">Anmeldedaten</h3>
    {% if ambience['event']['registration_soft_limit'] and ambience['event']['registration_soft_limit'] >= now() %}
        <p>
            {{ util.href(cdedblink("event/amend_registration_form"), "Ändern", aclass="btn btn-sm btn-warning",
                         icon='pencil') }}
            &ensp; Änderungen sind bis zum Anmeldeschluss ({{ ambience['event']['registration_soft_limit']|datetime(lang=lang)|e }})
            möglich.
        </p>
    {% endif %}

    <dl class="dl-horizontal">
        <dt>Gemischte Unterbringung</dt>
        <dd>
            {% if not age.may_mix() %}
                Keine geschlechter-gemischte Unterbringung möglich.
            {% else %}
                {% if registration['mixed_lodging'] %}
                    Ich bin mit einer geschlechter-gemischten Unterbringung einverstanden.
                {% else %}
                    Ich will geschlechter-getrennt untergebracht werden.
                {% endif %}
            {% endif %}
        </dd>
        <dt>Fotos</dt>
        <dd>
            Ich bin
            {% if not registration['foto_consent'] %}
                <strong>nicht</strong>
            {% endif %}
            damit einverstanden, dass Fotos und Aufnahmen meiner Person
            von dieser Veranstaltung für die
            Doku und eine CdE-interne,
            passwortgeschützte Fotogalerie verwendet werden.
        </dd>
    </dl>
    {% if registration['notes'] %}
        <dl class="dl-horizontal">
            <dt>Anmerkungen</dt>
            <dd>
                {{ registration['notes']|rst }}
            </dd>
        </dl>
    {% endif %}

    {% for track_id, track in registration['tracks']|dictsort %}
        {% if enums['RegistrationPartStati'](registration['parts'][ambience['event']['tracks'][track_id]['part_id']]['status']).is_involved() %}
            <h4>
                Kurswahl
                {% if ambience['event']['tracks']|length > 1 %}
                    für {{ ambience['event']['tracks'][track_id]['title']|e }}
                {% endif %}
            </h4>

            <dl class="dl-horizontal">
                {% if track['course_instructor'] %}
                    <dt>Kursleiter von</dt>
                    <dd><em>{{ courses[track['course_instructor']]['title']|e }}</em>.</dd>
                {% endif %}
                {% for prio in ("Erstwahl", "Zweitwahl", "Drittwahl") %}
                    <dt>{{ prio|e }}</dt>
                    <dd>
                        {% if registration['tracks'][track_id]['choices'][loop.index0] %}
                            {{ courses[registration['tracks'][track_id]['choices'][loop.index0]]['title']|e }}
                        {% else %}
                            —
                        {% endif %}
                    </dd>
                {% endfor %}
            </dl>
        {% endif %}
    {% endfor %}
{% endblock %}
