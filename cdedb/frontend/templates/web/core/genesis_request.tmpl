{% extends "web/core/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block title %}
    {% trans -%}
    	Request Account
    {%- endtrans %}
{% endblock %}
{% block content %}
    <p>
        {% trans -%}
        	With the following Form You can request an Account for the CdE-DB.
            Please give a short Rationale, what You want to use the Account for
            (for example for which Event You want to register).
        {%- endtrans %}
    </p>
    <p>
        {% trans -%}
        	After You have filled out this Form, You will be sent an E-Mail containing a verification link.
            You need to open this link to confirm Your Request. Only then Your Request will be reviewed by an Admin.
            You will be notified, when Your Account has been created.
        {%- endtrans %}
    </p>

    <form action="{{ cdedblink('core/genesis_request') }}" method="POST" id="genesisform" class="form-horizontal">
        <div>
            {{ util.form_input_text(name="given_names", label=gettext("Given Names"), small=True) }}
            {{ util.form_input_text(name="family_name", label=gettext("Family Name"), small=True) }}
            {{ util.form_input_text(name="username", label=gettext("E-Mail"), small=True, type="email") }}
            {{ util.form_input_select(name="realm", small=True, entries=(
                ("event", gettext("CdE-Event")),
                ("ml", gettext("CdE-Mailinglist"))),
                label=gettext("Rationale"), anid="realm-select") }}
            {{ util.form_input_textarea(name="notes",
                                        label=gettext("Rationale (max. %s Characters)")|format(max_rationale),
                                        small=True, maxlength=max_rationale) }}

            <noscript>
                <p class="text-muted">
                    {{ util.make_icon('info-sign') }}
                    {% trans -%}
                        The following fields are only relevant, if you are requesting an account for an event.
                    {%- endtrans %}
                </p>
            </noscript>
            {{ util.form_input_select(name="gender", entries=allowed_genders|enum_entries(processing=gettext),
                                      label=gettext("Gender"), small=True, aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="birthday", label=gettext("Birthday"), placeholder="YYYY-MM-DD",
                                    type="date", small=True, aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="telephone", label=gettext("Phone"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="mobile", label=gettext("Mobile Phone"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="address", label=gettext("Street"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="address_supplement", label=gettext("Address Supplement"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="postal_code", label=gettext("Zipcode"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="location", label=gettext("City"), small=True,
                                    aclass="genesis-realm-specific") }}
            {{ util.form_input_text(name="country", label=gettext("Country"), small=True,
                                    aclass="genesis-realm-specific") }}

            <script type="text/javascript" nonce="{{ csp_nonce }}">
                var $select = $('#realm-select');
                var $realmSpecificFields = $('.genesis-realm-specific');
                var fieldsPerRealm = {{ realm_specific_genesis_fields|json|s }};
                var show_realm_specific_fields = function() {
                    $realmSpecificFields.each(function() {
                        if (fieldsPerRealm[$select.val()].indexOf($(this).prop('name')) >= 0) {
                            $(this).closest('.form-group').show();
                        } else {
                            $(this).closest('.form-group').hide();
                        }
                    });
                };
                $select.change(show_realm_specific_fields);
                show_realm_specific_fields();
            </script>

            {{ util.form_input_submit(value=gettext("Confirm Request"), small=True) }}
        </div>
    </form>
{% endblock %}
