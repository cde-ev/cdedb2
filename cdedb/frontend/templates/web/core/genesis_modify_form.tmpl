{% set sidenav_active='core_genesis_list' %}
{% extends "web/core/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% block scripts %}{{ util.cdedb_script('cdedb_helper.js') }}{% endblock %}
{% set jshint='weak' %}
{% block title %}
    {% trans -%}
    	Edit Account Request
    {%- endtrans %}
{% endblock %}
{% block breadcrumb %}
{{ super() }}
{{ util.breadcrumb_link(cdedblink("core/genesis_list_cases"), gettext("Account Requests")) }}
{{ util.breadcrumb_link(cdedblink("core/genesis_modify_form", {'case_id': values['case_id']}),
                        gettext("Edit Account Request from %(given_names)s %(family_name)s")|format(
                            given_names=values["given_names"], family_name=values["family_name"]),
                        active="True", icon="user") }}
{% endblock %}
{% block content %}
    <form action="{{ cdedblink('core/genesis_modify') }}" method="POST" id="genesismodifyform" class="form-horizontal">
        {{ util.anti_csrf_token('core/genesis_modify') }}
        <div>
            {{ util.form_input_text(name="given_names", label=gettext("Given Names"), small=True) }}
            {{ util.form_input_text(name="family_name", label=gettext("Family Name"), small=True) }}
            {{ util.form_input_text(name="username", label=gettext("E-Mail"), small=True, type="email") }}
            {% if "core_admin" in user.roles %}
                {{ util.form_input_select(
                    name="realm", small=True, entries=(("event", gettext("CdE-Event")),
                                                       ("ml", gettext("CdE-Mailinglist"))),
                    label=gettext("Realm"), anid="realm-select") }}
            {% else %}
                {% with realms = {'event': (gettext("Event"), 'blackboard'),
                                  'ml': (gettext("Mailinglist"), 'envelope')} %}
                    {{ util.make_icon(values['realm'][1]) }} {{ values['realm'][0] }}
                {% endwith %}
                {{ util.form_input_hidden(name="realm") }}
            {% endif %}
            {{ util.form_input_textarea(name="notes",
                                        label=gettext("Rationale (max. %s Characters)")|format(max_rationale),
                                        small=True, maxlength=max_rationale) }}
            <div id="event-field-container">
                <p class="text-muted">{{ util.make_icon('info-sign') }}
                    {% trans -%}The following fields are only relevant for Event-Account Requests.{%- endtrans %}</p>
                {{ util.form_input_select(name="gender", entries=enums['Genders']|enum_entries(processing=gettext),
                                          label=gettext("Gender"), small=True) }}
                {{ util.form_input_text(name="birthday", label=gettext("Birthday"),
                                        placeholder="YYYY-MM-DD", type="date", small=True) }}
                {{ util.form_input_text(name="telephone", label=gettext("Phone"), small=True) }}
                {{ util.form_input_text(name="mobile", label=gettext("Mobile Phone"), small=True) }}
                {{ util.form_input_text(name="address", label=gettext("Street"), small=True) }}
                {{ util.form_input_text(name="address_supplement", label=gettext("Address Supplement"), small=True) }}
                {{ util.form_input_text(name="postal_code", label=gettext("Zipcode"), small=True) }}
                {{ util.form_input_text(name="location", label=gettext("City"), small=True) }}
                {{ util.form_input_text(name="country", label=gettext("Country"), small=True) }}
            </div>

            <script type="text/javascript" nonce="{{ csp_nonce }}">
                var $select = $('#realm-select');
                var show_event_fields = function() {
                    if ($select.val() === 'event') {
                        $('#event-field-container').show();
                    } else {
                        $('#event-field-container').hide();
                    }
                };
                $select.change(show_event_fields);
                show_event_fields();
            </script>

            {{ util.form_input_submit(value=gettext("Save"), small=True, cancellink=cdedblink("core/genesis_show_case")) }}
        </div>
    </form>
{% endblock %}
