{# This is the base template to be extended by (nearly) all html templates.
   It provides a skeleton where only the content needs to be filled in. #}
{% import "web/util.tmpl" as util with context %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>CdEDB – {% block title %}CdEDB{% endblock %}</title>
        <link rel="shortcut icon" type="image/x-icon" href="{{ staticurl("favicon.ico")|e }}" media="print" />

        <script type="text/javascript" src="{{ staticurl("jquery-3.min.js")|e }}"></script>
        <link href="{{ staticurl("bootstrap-3/css/bootstrap.min.css")|e }}" rel="stylesheet" media="all" />
        <script type="text/javascript" src="{{ staticurl("bootstrap-3/js/bootstrap.min.js")|e }}"></script>
        <script type="text/javascript" src="{{ staticurl("cdedb-general.js")|e }}"></script>
        {% if CDEDB_DEV %}
            <!-- script for adding links to view emails -->
            <script type="text/javascript">
                $(function() {
                    $("div.alert-info").append(function(index, html){
                        /* search for paths of temporary mail files and create link */
                        var pos = html.indexOf(" /tmp/cdedb-mail-");
                        if (pos >= 0) {
                            var endpos = html.indexOf(".txt ", pos);
                            var token = html.substring(pos + 17, endpos);
                            var link = "{{ cdedblink('core/debug_email', magic_placeholders=['token']) }}"
                                .replace('_CDEDB_MAGIC_URL_PLACEHOLDER_0_', token);
                            return '(<a href="' + link + '">View Email in Browser</a>)';
                        }
                    });
                });
            </script>
        {% endif %}

        {% block scripts %}{% endblock %}

        <link rel="stylesheet" type="text/css" href="{{ staticurl("cdedb.css")|e }}" media="all" />
        <link rel="stylesheet" type="text/css" href="{{ staticurl("print.css")|e }}" media="print" />
    </head>
    <body>
        <div class="container page" id="maincontainer">
            <div class="clearfix" role="banner">
                {% if I18N_LANGUAGES %}
                    <div class="pull-right">
                        <form action="{{ cdedblink('core/change_locale') }}" id="changelocaleform" method="post"
                              style="display: inline;">
                            {% if request_url %}
                                <input type="hidden" name="wants"
                                       value="{{ encode_parameter("core/change_locale", "wants", request_url)|e }}" />
                            {% endif %}
                            {% with TITLES = {'de': ("deutsch", "auf deutsch umschalten"),
                                              'en': ("engish", "switch to english"),} %}
                                {% for l in I18N_LANGUAGES if l != lang %}
                                    <button type="submit" class="btn btn-link" name="locale" value="{{ l|e }}"
                                            title="{{ TITLES.get(l, (None, None))[1]|e }}">
                                        <img src="{{ staticurl("flags/{}.png".format(l))|e }}"
                                             alt="{{ TITLES.get(l, (None, None))[0]|e }}" />
                                    </button>
                                {% endfor %}
                            {% endwith %}
                        </form>
                    </div>
                {% endif %}
                <div class="logo pull-left">
                    <img src="{{ staticurl("logo.svg")|e }}" alt="CdE-Datenbank" />
                </div>
                
                {% if jshint %}
                    <noscript>
                        {% if jshint == 'strong' %}
                            <div class="jshint pull-right text-danger">
                                {{ util.make_icon('warning-sign') }}
                                {% trans %}This site provides additional functionality with JavaScript enabled.{% endtrans %}
                            </div>
                        {% else %}
                            <div class="jshint pull-right text-warning">
                                {{ util.make_icon('warning-sign') }}
                                {% trans %}This site can be used more easily with JavaScript enabled.{% endtrans %}
                            </div>
                        {% endif %}
                    </noscript>
                {% endif %}
            </div>
            <!-- main navigation bar -->
            <nav class="navbar navbar-default" aria-label="{% trans %}Main Menu{% endtrans %}">
                <div class="navbar-header">
                    <p class="navbar-collapse-header">{% trans %}Main Menu{% endtrans %}</p>
                    <button type="button" class="navbar-toggle collapsed hide" data-toggle="collapse"
                            data-target="#navbar-collapse-1" aria-expanded="false" id="button-navbar-toggle">
                        <span class="sr-only">{% trans %}Display Main Menu{% endtrans %}</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>

                <div class="collapse navbar-collapse in" id="navbar-collapse-1">
                    {% if "persona" in user.roles %}
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <form action="{{ cdedblink("core/logout")|e }}" method="POST" id="logoutform"
                                  class="navbar-form">
                                    <p class="navbar-text">
                                        <span class="sr-only">{% trans %}Logged-In as{% endtrans %}</span>
                                        <span id="displayname">
                                            {{ util.href(cdedblink("core/mydata"), user.display_name, icon="user") }}
                                        </span>
                                    </p>
                                    <button type="submit" name="submitlogout" value="{% trans %}Logout{% endtrans %}"
                                      class="btn navbar-button btn-default" title="{% trans %}Logout{% endtrans %}">
                                        <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                                        <span class="visible-xs-inline-block">{% trans %}Logout{% endtrans %}</span>
                                    </button>
                                </form>
                            </li>
                        </ul>
                    {% endif %}

                    <ul class="nav navbar-nav">
                        <li {% if mainnav_active == 'core' %}class="active" aria-current="page"{% endif %}>
                            {{ util.href(cdedblink("core/index"), gettext("Index"), icon="home") }}
                            </li>
                        {% if "cde" in user.roles %}
                            <li {% if mainnav_active == 'cde' %}class="active" aria-current="page"{% endif %}>
                                {{ util.href(cdedblink("cde/index"), gettext("Members"), icon="education") }}
                                </li>
                        {% endif %}
                        {% if "event" in user.roles %}
                            <li {% if mainnav_active == 'event' %}class="active" aria-current="page"{% endif %}>
                                {{ util.href(cdedblink("event/index"), gettext("Events"), icon="blackboard") }}
                            </li>
                        {% endif %}
                        {% if "ml" in user.roles %}
                            <li {% if mainnav_active == 'ml' %}class="active" aria-current="page"{% endif %}>
                                {{ util.href(cdedblink("ml/index"), gettext("Mailinglists"), icon="envelope") }}
                            </li>
                        {% endif %}
                        {% if "assembly" in user.roles %}
                            <li {% if mainnav_active == 'assembly' %}class="active" aria-current="page"{% endif %}>
                                {{ util.href(cdedblink("assembly/index"), gettext("Assemblies"), icon="bullhorn") }}
                            </li>
                        {% endif %}
                    </ul>
                </div><!-- /.navbar-collapse -->
            </nav>
            <script type="text/javascript">
                $('#navbar-collapse-1').removeClass('in');
                $('#button-navbar-toggle').removeClass('hide');
            </script>

            <div class="row">
                <div class="col-md-3" role="navigation" id="sidebar" aria-label="{% trans %}Sub Menu{% endtrans %}">
                    {% block navigation %}
                    {% endblock %}
                </div>
                <div class="col-md-9">
                    {% if self.breadcrumb %}
                        <h6 id="bc-title" class="sr-only">{% trans %}You are here:{% endtrans %}</h6>
                        <ol class="breadcrumb breadcrumb-hanging" role="navigation" aria-labelledby="bc-title">
                            {% block breadcrumb %}{% endblock %}
                        </ol>
                    {% endif %}

                    <div id="notifications">
                        {% with icontypes = {"success" : "ok-sign", "info" : "info-sign", "question" : "question-sign",
                                             "warning" : "exclamation-sign", "error" : "remove-sign"},
                                alerttypes = {"success" : "success", "info" : "info", "question" : "info",
                                              "warning" : "warning", "error" : "danger"},
                                messagetypes = {"success" : _("Success!"), "info" : _("Info!"), "question" : _("Question:"),
                                                "warning" : _("Warning!"), "error" : _("Error!")} %}
                            {% for ntype, message, params in notifications %}
                                <div class="alert alert-{{ alerttypes[ntype] }}" role="alert">
                                    <span class="glyphicon glyphicon-{{ icontypes[ntype] }}" aria-hidden="true"></span>
                                    <strong>{{ messagetypes[ntype] }}</strong>
                                    <span class="notificationMessage">{{ gettext(message).format(**params)|e }}</span>
                                </div>
                            {% endfor %}
                        {% endwith %}
                    </div>

                    <div role="main">
                        {% block heading %}
                            <h1 class="title">{{ gettext(self.title()) }}</h1>
                        {% endblock %}

                        <div id="content">
                            {% block content %}
                                {% trans %}This should not be visible.{% endtrans %}
                            {% endblock %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer" class="container">
            {% block footer %}
                © {% trans %}Club der Ehemaligen e.V.{% endtrans %} – {% trans %}Database-Development-Team{% endtrans %}
                <a href="mailto:{% trans %}CdE-Database-Development-Team{% endtrans %} <cdedb@lists.cde-ev.de>">&lt;cdedb@lists.cde-ev.de&gt;</a>
                <br /> {% trans %}Version{% endtrans %} {{ GIT_COMMIT|e }}
                {% if CDEDB_DEV %}
                    <br /><br />
                    <div style="word-wrap: break-word;">{{ debugstring|e }} ; time taken: {{ generation_time()|e }}</div>
                {% endif %}
            {% endblock %}
        </div>
    </body>
    {% if errors %}
        <!-- error listing for debugging
             {{ errors|e }}
        -->
    {% endif %}
</html>
