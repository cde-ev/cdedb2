{% set sidenav_active='assembly_ballots' if ambience['ballot'] else 'assembly_show' %}
{% extends "web/assembly/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% import "web/assembly/util.tmpl" as assembly_util with context %}
{% block scripts %}{{ util.cdedb_script('cdedb_helper.js') }}{% endblock %}
{% set jshint = 'weak' %}
{% block title %}
    {% if ambience['ballot'] %}
        {% trans title=ambience['assembly']['title'] + "/" + ambience['ballot']['title'] %}
            Attachment Details ({{ title }})
        {% endtrans %}
    {% else %}
        {% trans title=ambience['assembly']['title'] %}
            Attachment Details ({{ title }})
        {% endtrans %}
    {% endif %}
    â€“ {{ assembly_util.small_attachment_title(attachment, history, icon=False) }}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans %}
            Attachment Details
        {% endtrans %}
        <small>
            {{ assembly_util.small_attachment_title(attachment, history) }}
        </small>
    </h1>
{% endblock %}
{% block breadcrumb %}
    {{ super() }}
    {{ util.breadcrumb_link(cdedblink("assembly/show_assembly"), ambience['assembly']['title'], icon="bullhorn") }}
    {% if ambience['ballot'] %}
        {{ util.breadcrumb_link(cdedblink("assembly/list_ballots"), gettext("Ballots")) }}
        {{ util.breadcrumb_link(cdedblink("assembly/show_ballot"), ambience['ballot']['title'], icon="thumbs-up") }}
    {% endif %}
    {{ util.breadcrumb_link(cdedblink("assembly/show_attachment"),
                            assembly_util.small_attachment_title(attachment, history, icon=False),
                            active=True, icon="file") }}
    {{ util.breadcrumb_link(cdedblink("assembly/show_attachment"), gettext("Attachment Details"), active=True) }}

{% endblock %}
{% block content %}
    {% set edit = edit and ("assembly_contents" in user.admin_views) %}
    {% set ballot = ambience.get('ballot') %}
    {% if edit %}
        <div class="p">
            {{ assembly_util.add_attachment_version_button(attachment['id'], ballot=ballot, xs=False) }}
            {{ assembly_util.change_attachment_link_button(attachment['id'], ballot=ballot) }}
        </div>
    {% endif %}
    {{ assembly_util.attachment_list({attachment['id']: attachment}, {attachment['id']: history},
                                     ballot=ambience.get('ballot'), edit=edit, edit_buttons_below=False) }}
    {% if edit %}
        {% call util.bootstrap_panel(gettext("Actions"), icon="exclamation-triangle", aclass="panel-danger mosp") %}
            <div class="row">
                <div class="col-sm-4">
                    <div class="p">
                        {{ assembly_util.delete_attachment_button(attachment['id'], ballot=ballot) }}
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="p text-muted">
                        {% trans %}
                            Permanently deletes this attachment including all versions.
                        {% endtrans %}
                    </div>
                </div>
            </div>
        {% endcall %}
    {% endif %}
{% endblock %}
