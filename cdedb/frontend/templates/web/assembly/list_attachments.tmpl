{% set sidenav_active='assembly_attachments' %}
{% extends "web/assembly/base.tmpl" %}
{% import "web/util.tmpl" as util with context %}
{% import "web/assembly/util.tmpl" as assembly_util with context %}
{% block scripts %}{{ util.cdedb_script('cdedb_helper.js') }}{% endblock %}
{% set jshint = 'weak' %}
{% block title %}
    {% trans title=ambience['assembly']['title'] %}
        Attachment Overview ({{ title }})
    {% endtrans %}
{% endblock %}
{% block heading %}
    <h1 class="title">
        {% trans %}
            Attachment Overview
        {% endtrans %}
        <small>{{ util.make_icon('bullhorn') }} {{ ambience['assembly']['title'] }}</small>
    </h1>
{% endblock %}
{% block breadcrumb %}
    {{ super() }}
    {{ util.breadcrumb_link(cdedblink("assembly/show_assembly"), ambience['assembly']['title'], icon="bullhorn") }}
    {{ util.breadcrumb_link(cdedblink("assembly/list_attachments"), gettext("Attachment Overview"), active=True) }}

{% endblock %}
{% block content %}
    {% set edit_right = ambience['assembly']['is_active'] and ("assembly_presider" in user.admin_views
                                                               or ambience['assembly']['id'] in user.presider) %}
    {% if attachments %}
        <ul class="slim" id="attachments">
            {% for attachment_id, attachment in attachments.items() %}
                {% set attachment_versions = attachments_versions[attachment_id] %}
                {% set latest_version = attachment_versions[attachment["latest_version_nr"]] %}
                <li>
                    <div class="p" id="attachment_container_{{ attachment_id }}">
                        {{ assembly_util.print_attachment_version(
                                latest_version,
                                add=are_attachment_versions_creatable[attachment_id],
                                delete=are_attachment_versions_deletable[attachment_id],
                                delete_attachment=are_attachments_deletable[attachment_id]) }}
                        {% if attachment_versions|length > 1 %}
                            <ul>
                                {% for version_nr, version in attachment_versions|keydictsort(EntitySorter.attachment_version)|reverse %}
                                    {% if version_nr != latest_version['version_nr'] %}
                                        <li>
                                            {{ assembly_util.print_attachment_version(
                                                    version,
                                                    add=False,
                                                    delete=are_attachment_versions_deletable[attachment_id],
                                                    delete_attachment=False) }}
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if not attachments and not edit_right %}
        <p class="text-muted">
            {% trans %}No attachments have been uploaded yet.{% endtrans %}
        </p>
    {% endif %}

    {% if edit_right %}
        {{ util.href(cdedblink("assembly/add_attachment_form"),
                    label=gettext("Add Attachment"), aclass="btn btn-success", icon=util.make_icon("plus")) }}
    {% endif %}
{% endblock %}
