{% macro administrate_ballot() -%}
  <div class="p">
      {{ util.href(cdedblink("assembly/change_ballot_form"), gettext("Edit"), icon="pencil",
              aclass="btn btn-sm btn-warning") }}
      {% if CDEDB_DEV %}
          <form action="{{ cdedblink("assembly/ballot_start_voting") }}" method="POST"
                id="startvotingform" style="display: inline;">
              {{ util.anti_csrf_token("assembly/ballot_start_voting") }}
              {{ util.input_submit(value=gettext("Start Voting"), aclass="btn btn-sm btn-success",
                      icon="check") }}
          </form>
      {% endif %}
  </div>
{%- endmacro %}

{# Admin modification options (delete and edit) #}
{% macro administrate_ballot() -%}
    <div class="p">
        {{ util.href(cdedblink("assembly/change_ballot_form"), gettext("Edit"), icon="pencil",
                aclass="btn btn-sm btn-warning") }}
        {% if CDEDB_DEV %}
            <form action="{{ cdedblink("assembly/ballot_start_voting") }}" method="POST"
                  id="startvotingform" style="display: inline;">
                {{ util.anti_csrf_token("assembly/ballot_start_voting") }}
                {{ util.input_submit(value=gettext("Start Voting"), aclass="btn btn-sm btn-success",
                        icon="check") }}
            </form>
        {% endif %}
    </div>
{%- endmacro %}

    
{% macro delete_ballot() -%}
    {% call util.bootstrap_panel(title=gettext("Actions"), icon="warning-sign", aclass="panel-danger mosp") %}
        <div class="row">
            <div class="col-sm-4">
                <div class="p">
                     <form action="{{ cdedblink('assembly/delete_ballot') }}" method="POST" id="deleteballotform"
                           style="display: inline;">
                         {{ util.anti_csrf_token('assembly/delete_ballot') }}
                         {{ util.input_submit(value=gettext("Delete"), icon="trash", aclass="btn btn-danger") }}
                         {{ util.input_checkbox(name="ack_delete", label=gettext("Are you sure?")) }}
                     </form>
                     <script type="text/javascript" nonce="{{ csp_nonce }}">
                         $(function() {
                             $('#deleteballotform').cdedbProtectAction(
                                 "{{ gettext("This ballot and all its data will be permanently deleted.") }}");
                             $('#deleteballotform').find('[name="ack_delete"]').prop('checked', true)
                                 .parent().hide();
                         });
                     </script>
                </div>
            </div>
            <div class="col-sm-8">
                <p class="text-muted">
                    {% trans -%}Deletes the ballot and all associated settings and candidates.{%- endtrans %}
                </p>
            </div>
        </div>
    {% endcall %}
{%- endmacro %}

{% macro show_attachments(attachments, edit_mode) -%}
    {% if attachments or edit_mode %}
        {% call util.bootstrap_panel(title=gettext("Files"), icon='file') %}
            {% if attachments %}
                <ul>
                    {% for attachment_id, attachment in attachments|xdictsort("title") %}
                        <li>
                            {{ util.href(cdedblink("assembly/get_attachment", {'attachment_id': attachment_id}),
                                    attachment['title']) }}
                            {% if edit_mode %}
                                <form action="{{ cdedblink('assembly/remove_attachment',
                                                           {'attachment_id': attachment_id}) }}"
                                        method="POST" id="removeattachmentform{{ attachment_id }}"
                                        style="display: inline;">
                                    {{ util.anti_csrf_token('assembly/remove_attachment') }}
                                    {{ util.input_checkbox("attachment_ack_delete", gettext("Are you sure?")) }}
                                    {{ util.input_submit(value="", aclass="btn btn-xs btn-danger", icon="trash",
                                            title=gettext("Delete File")) }}
                                </form>
                                <script type="text/javascript" nonce="{{ csp_nonce }}">
                                    $('#removeattachmentform{{ attachment_id }}').cdedbProtectAction("{{ gettext("The attachment will be permanently deleted.") }}");
                                    $('#removeattachmentform{{ attachment_id }}').find('[name="attachment_ack_delete"]').prop('checked', true).parent().hide();
                                </script>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if edit_mode %}
                {{ util.href(cdedblink("assembly/add_attachment_form"), gettext("Attach File"),
                             aclass="btn btn-success btn-sm", icon="plus") }}
            {% endif %}
        {% endcall %}
    {% endif %}
{%- endmacro %}
